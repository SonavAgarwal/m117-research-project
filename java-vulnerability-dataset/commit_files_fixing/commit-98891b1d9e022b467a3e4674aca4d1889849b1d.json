{
    "sha": "98891b1d9e022b467a3e4674aca4d1889849b1d5",
    "node_id": "MDY6Q29tbWl0MjY2Mjg5NTQ6OTg4OTFiMWQ5ZTAyMmI0NjdhM2U0Njc0YWNhNGQxODg5ODQ5YjFkNQ==",
    "commit": {
        "author": {
            "name": "Bernard Wagner",
            "email": "s10156225@gmail.com",
            "date": "2018-06-15T08:54:31Z"
        },
        "committer": {
            "name": "Paulo Lopes",
            "email": "paulo@mlopes.net",
            "date": "2018-07-12T10:19:38Z"
        },
        "message": "Validate that X-XSRF-Token and X-XSRF-Token cookie are the same - fixes #970\n(cherry picked from commit 482bc72)\n\n(cherry picked from commit f42b193)",
        "tree": {
            "sha": "2c715e2b263083a482be476f6ab47558914fd3cb",
            "url": "https://api.github.com/repos/vert-x3/vertx-web/git/trees/2c715e2b263083a482be476f6ab47558914fd3cb"
        },
        "url": "https://api.github.com/repos/vert-x3/vertx-web/git/commits/98891b1d9e022b467a3e4674aca4d1889849b1d5",
        "comment_count": 0,
        "verification": {
            "verified": true,
            "reason": "valid",
            "signature": "-----BEGIN PGP SIGNATURE-----\n\niQFFBAABCAAvFiEEuODA8Q/oVAMyhY6WB1zabpwB8yUFAltHKzoRHHBhdWxvQG1s\nb3Blcy5uZXQACgkQB1zabpwB8yVS+gf/QjSfn3B/mJhvDNt8xFh1e3m+EDjWfaSg\nsHHny+ru30yJE5LVf8b7CsaeeqQIUO5Io8JRCdMb4mmZcSPr9+CxhMUrTcGQhjQ7\n0NsGETMiXWHUXEppKY/vE5orOB2Jg9lbiPU0YD0GEYa8FPBhHc6ldsBAmAj9ulRd\nxAcZVMDtDEHGo0fHGV+/hWvHfgK+WdvHvdi8+2DuK2qJPnLE4Jr21gYRwmVQ0rII\ndp6HfJPndCYXRYJ8o9r4PuI/0A9OKUHnmmzo3Bk9so2KEwdHZB15lbIWeLrkCU1s\niy2J+Ml3QkRfuTItJF1WDLgyMnuCOFE1H32reqAD8+5en7fkIH8lMA==\n=2wsx\n-----END PGP SIGNATURE-----",
            "payload": "tree 2c715e2b263083a482be476f6ab47558914fd3cb\nparent e7c4460ee4cc0a3b7135dc01499b1cc2fe269505\nauthor Bernard Wagner <s10156225@gmail.com> 1529052871 +0200\ncommitter Paulo Lopes <paulo@mlopes.net> 1531390778 +0200\n\nValidate that X-XSRF-Token and X-XSRF-Token cookie are the same - fixes #970\n(cherry picked from commit 482bc72)\n\n(cherry picked from commit f42b193)\n",
            "verified_at": "2024-11-14T05:05:49Z"
        }
    },
    "url": "https://api.github.com/repos/vert-x3/vertx-web/commits/98891b1d9e022b467a3e4674aca4d1889849b1d5",
    "html_url": "https://github.com/vert-x3/vertx-web/commit/98891b1d9e022b467a3e4674aca4d1889849b1d5",
    "comments_url": "https://api.github.com/repos/vert-x3/vertx-web/commits/98891b1d9e022b467a3e4674aca4d1889849b1d5/comments",
    "author": {
        "login": "bernard-wagner",
        "id": 4208881,
        "node_id": "MDQ6VXNlcjQyMDg4ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4208881?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bernard-wagner",
        "html_url": "https://github.com/bernard-wagner",
        "followers_url": "https://api.github.com/users/bernard-wagner/followers",
        "following_url": "https://api.github.com/users/bernard-wagner/following{/other_user}",
        "gists_url": "https://api.github.com/users/bernard-wagner/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bernard-wagner/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bernard-wagner/subscriptions",
        "organizations_url": "https://api.github.com/users/bernard-wagner/orgs",
        "repos_url": "https://api.github.com/users/bernard-wagner/repos",
        "events_url": "https://api.github.com/users/bernard-wagner/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bernard-wagner/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "committer": {
        "login": "pmlopes",
        "id": 849467,
        "node_id": "MDQ6VXNlcjg0OTQ2Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/849467?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pmlopes",
        "html_url": "https://github.com/pmlopes",
        "followers_url": "https://api.github.com/users/pmlopes/followers",
        "following_url": "https://api.github.com/users/pmlopes/following{/other_user}",
        "gists_url": "https://api.github.com/users/pmlopes/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/pmlopes/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pmlopes/subscriptions",
        "organizations_url": "https://api.github.com/users/pmlopes/orgs",
        "repos_url": "https://api.github.com/users/pmlopes/repos",
        "events_url": "https://api.github.com/users/pmlopes/events{/privacy}",
        "received_events_url": "https://api.github.com/users/pmlopes/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "parents": [
        {
            "sha": "e7c4460ee4cc0a3b7135dc01499b1cc2fe269505",
            "url": "https://api.github.com/repos/vert-x3/vertx-web/commits/e7c4460ee4cc0a3b7135dc01499b1cc2fe269505",
            "html_url": "https://github.com/vert-x3/vertx-web/commit/e7c4460ee4cc0a3b7135dc01499b1cc2fe269505"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 4,
        "deletions": 3
    },
    "files": [
        {
            "sha": "7040419057521718f564be8af813828dd2120211",
            "filename": "vertx-web/src/main/java/io/vertx/ext/web/handler/impl/CSRFHandlerImpl.java",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vert-x3/vertx-web/blob/98891b1d9e022b467a3e4674aca4d1889849b1d5/vertx-web%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fext%2Fweb%2Fhandler%2Fimpl%2FCSRFHandlerImpl.java",
            "raw_url": "https://github.com/vert-x3/vertx-web/raw/98891b1d9e022b467a3e4674aca4d1889849b1d5/vertx-web%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fext%2Fweb%2Fhandler%2Fimpl%2FCSRFHandlerImpl.java",
            "contents_url": "https://api.github.com/repos/vert-x3/vertx-web/contents/vertx-web%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fext%2Fweb%2Fhandler%2Fimpl%2FCSRFHandlerImpl.java?ref=98891b1d9e022b467a3e4674aca4d1889849b1d5",
            "patch": "@@ -106,9 +106,9 @@ private String generateToken() {\n     return saltPlusToken + \".\" + signature;\n   }\n \n-  private boolean validateToken(String header) {\n+  private boolean validateToken(String header, String cookie) {\n \n-    if (header == null) {\n+    if (header == null || cookie == null || !header.equals(cookie)) {\n       return false;\n     }\n \n@@ -168,7 +168,8 @@ public void handle(RoutingContext ctx) {\n       case DELETE:\n       case PATCH:\n         final String header = ctx.request().getHeader(headerName);\n-        if (validateToken(header == null ? ctx.request().getFormAttribute(headerName) : header)) {\n+        final String cookie = ctx.getCookie(cookieName).getValue();\n+        if (validateToken(header == null ? ctx.request().getFormAttribute(headerName) : header, cookie)) {\n           ctx.next();\n         } else {\n           forbidden(ctx);"
        }
    ]
}