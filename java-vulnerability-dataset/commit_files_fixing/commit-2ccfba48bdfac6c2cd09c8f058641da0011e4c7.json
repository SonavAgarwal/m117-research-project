{
    "sha": "2ccfba48bdfac6c2cd09c8f058641da0011e4c7e",
    "node_id": "MDY6Q29tbWl0ODMyNjc2OjJjY2ZiYTQ4YmRmYWM2YzJjZDA5YzhmMDU4NjQxZGEwMDExZTRjN2U=",
    "commit": {
        "author": {
            "name": "Colm O hEigeartaigh",
            "email": "coheigea@apache.org",
            "date": "2020-06-03T16:37:44Z"
        },
        "committer": {
            "name": "jbonofre",
            "email": "jbonofre@apache.org",
            "date": "2020-06-05T04:47:26Z"
        },
        "message": "Disallow calling getMBeansFromURL\n\n(cherry picked from commit 3e4c4bed2d08e81ca5961ab5fcadab23470db1c9)",
        "tree": {
            "sha": "cc270d83e5cb9fa47ec79b9b9e98e33dd7d17af0",
            "url": "https://api.github.com/repos/apache/karaf/git/trees/cc270d83e5cb9fa47ec79b9b9e98e33dd7d17af0"
        },
        "url": "https://api.github.com/repos/apache/karaf/git/commits/2ccfba48bdfac6c2cd09c8f058641da0011e4c7e",
        "comment_count": 0,
        "verification": {
            "verified": false,
            "reason": "unsigned",
            "signature": null,
            "payload": null,
            "verified_at": null
        }
    },
    "url": "https://api.github.com/repos/apache/karaf/commits/2ccfba48bdfac6c2cd09c8f058641da0011e4c7e",
    "html_url": "https://github.com/apache/karaf/commit/2ccfba48bdfac6c2cd09c8f058641da0011e4c7e",
    "comments_url": "https://api.github.com/repos/apache/karaf/commits/2ccfba48bdfac6c2cd09c8f058641da0011e4c7e/comments",
    "author": {
        "login": "coheigea",
        "id": 472162,
        "node_id": "MDQ6VXNlcjQ3MjE2Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/472162?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/coheigea",
        "html_url": "https://github.com/coheigea",
        "followers_url": "https://api.github.com/users/coheigea/followers",
        "following_url": "https://api.github.com/users/coheigea/following{/other_user}",
        "gists_url": "https://api.github.com/users/coheigea/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/coheigea/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/coheigea/subscriptions",
        "organizations_url": "https://api.github.com/users/coheigea/orgs",
        "repos_url": "https://api.github.com/users/coheigea/repos",
        "events_url": "https://api.github.com/users/coheigea/events{/privacy}",
        "received_events_url": "https://api.github.com/users/coheigea/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "committer": {
        "login": "jbonofre",
        "id": 158903,
        "node_id": "MDQ6VXNlcjE1ODkwMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/158903?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jbonofre",
        "html_url": "https://github.com/jbonofre",
        "followers_url": "https://api.github.com/users/jbonofre/followers",
        "following_url": "https://api.github.com/users/jbonofre/following{/other_user}",
        "gists_url": "https://api.github.com/users/jbonofre/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jbonofre/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jbonofre/subscriptions",
        "organizations_url": "https://api.github.com/users/jbonofre/orgs",
        "repos_url": "https://api.github.com/users/jbonofre/repos",
        "events_url": "https://api.github.com/users/jbonofre/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jbonofre/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "parents": [
        {
            "sha": "cf8191b4b4b9655d3d578fcba8681b04248c31fa",
            "url": "https://api.github.com/repos/apache/karaf/commits/cf8191b4b4b9655d3d578fcba8681b04248c31fa",
            "html_url": "https://github.com/apache/karaf/commit/cf8191b4b4b9655d3d578fcba8681b04248c31fa"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 13,
        "deletions": 4
    },
    "files": [
        {
            "sha": "a1527cb301f723f37629223a7c899c4ae93f1819",
            "filename": "management/server/src/main/java/org/apache/karaf/management/KarafMBeanServerGuard.java",
            "status": "modified",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/apache/karaf/blob/2ccfba48bdfac6c2cd09c8f058641da0011e4c7e/management%2Fserver%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fkaraf%2Fmanagement%2FKarafMBeanServerGuard.java",
            "raw_url": "https://github.com/apache/karaf/raw/2ccfba48bdfac6c2cd09c8f058641da0011e4c7e/management%2Fserver%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fkaraf%2Fmanagement%2FKarafMBeanServerGuard.java",
            "contents_url": "https://api.github.com/repos/apache/karaf/contents/management%2Fserver%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fkaraf%2Fmanagement%2FKarafMBeanServerGuard.java?ref=2ccfba48bdfac6c2cd09c8f058641da0011e4c7e",
            "patch": "@@ -107,7 +107,7 @@ public Object invoke(Object proxy, Method method, Object[] args) throws Throwabl\n         } else if (\"setAttributes\".equals(method.getName())) {\n             handleSetAttributes(mbs, objectName, (AttributeList) args[1]);\n         } else if (\"invoke\".equals(method.getName())) {\n-            handleInvoke(objectName, (String) args[1], (Object[]) args[2], (String[]) args[3]);\n+            handleInvoke(mbs, objectName, (String) args[1], (Object[]) args[2], (String[]) args[3]);\n         }\n \n         return null;\n@@ -346,11 +346,20 @@ private boolean canBypassRBAC(BulkRequestContext context, ObjectName objectName,\n         return false;\n     }\n \n-    void handleInvoke(ObjectName objectName, String operationName, Object[] params, String[] signature) throws IOException {\n-        handleInvoke(null, objectName, operationName, params, signature);\n+    void handleInvoke(MBeanServer mbs, ObjectName objectName, String operationName, Object[] params, String[] signature) throws IOException, InstanceNotFoundException {\n+        handleInvoke(mbs, null, objectName, operationName, params, signature);\n     }\n \n-    void handleInvoke(BulkRequestContext context, ObjectName objectName, String operationName, Object[] params, String[] signature) throws IOException {\n+    void handleInvoke(MBeanServer mbs, BulkRequestContext context, ObjectName objectName, String operationName, Object[] params, String[] signature) throws IOException, InstanceNotFoundException {\n+        if (mbs != null && mbs.isInstanceOf(objectName, \"javax.management.loading.MLet\")\n+            && (\"addUrl\".equals(operationName) || \"getMBeansFromURL\".equals(operationName))) {\n+            SecurityException se = new SecurityException(operationName + \" is not allowed to be invoked\");\n+            if (logger != null) {\n+                logger.log(INVOKE, INVOKE_SIG, null, se, objectName, operationName, signature, params);\n+            }\n+            throw se;\n+        }\n+\n         if (context == null) {\n             context = BulkRequestContext.newContext(configAdmin);\n         }"
        }
    ]
}