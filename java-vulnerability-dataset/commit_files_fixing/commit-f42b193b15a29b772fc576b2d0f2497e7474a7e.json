{
    "sha": "f42b193b15a29b772fc576b2d0f2497e7474a7e9",
    "node_id": "MDY6Q29tbWl0MjY2Mjg5NTQ6ZjQyYjE5M2IxNWEyOWI3NzJmYzU3NmIyZDBmMjQ5N2U3NDc0YTdlOQ==",
    "commit": {
        "author": {
            "name": "Bernard Wagner",
            "email": "s10156225@gmail.com",
            "date": "2018-06-15T08:54:31Z"
        },
        "committer": {
            "name": "Julien Viet",
            "email": "julien@julienviet.com",
            "date": "2018-07-12T10:04:21Z"
        },
        "message": "Validate that X-XSRF-Token and X-XSRF-Token cookie are the same - fixes #970\n(cherry picked from commit 482bc72)",
        "tree": {
            "sha": "c2db3c2655fb321e70a84e8a3f2c868046b90a87",
            "url": "https://api.github.com/repos/vert-x3/vertx-web/git/trees/c2db3c2655fb321e70a84e8a3f2c868046b90a87"
        },
        "url": "https://api.github.com/repos/vert-x3/vertx-web/git/commits/f42b193b15a29b772fc576b2d0f2497e7474a7e9",
        "comment_count": 0,
        "verification": {
            "verified": false,
            "reason": "unsigned",
            "signature": null,
            "payload": null,
            "verified_at": null
        }
    },
    "url": "https://api.github.com/repos/vert-x3/vertx-web/commits/f42b193b15a29b772fc576b2d0f2497e7474a7e9",
    "html_url": "https://github.com/vert-x3/vertx-web/commit/f42b193b15a29b772fc576b2d0f2497e7474a7e9",
    "comments_url": "https://api.github.com/repos/vert-x3/vertx-web/commits/f42b193b15a29b772fc576b2d0f2497e7474a7e9/comments",
    "author": {
        "login": "bernard-wagner",
        "id": 4208881,
        "node_id": "MDQ6VXNlcjQyMDg4ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4208881?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bernard-wagner",
        "html_url": "https://github.com/bernard-wagner",
        "followers_url": "https://api.github.com/users/bernard-wagner/followers",
        "following_url": "https://api.github.com/users/bernard-wagner/following{/other_user}",
        "gists_url": "https://api.github.com/users/bernard-wagner/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bernard-wagner/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bernard-wagner/subscriptions",
        "organizations_url": "https://api.github.com/users/bernard-wagner/orgs",
        "repos_url": "https://api.github.com/users/bernard-wagner/repos",
        "events_url": "https://api.github.com/users/bernard-wagner/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bernard-wagner/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "committer": {
        "login": "vietj",
        "id": 225674,
        "node_id": "MDQ6VXNlcjIyNTY3NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/225674?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vietj",
        "html_url": "https://github.com/vietj",
        "followers_url": "https://api.github.com/users/vietj/followers",
        "following_url": "https://api.github.com/users/vietj/following{/other_user}",
        "gists_url": "https://api.github.com/users/vietj/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/vietj/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/vietj/subscriptions",
        "organizations_url": "https://api.github.com/users/vietj/orgs",
        "repos_url": "https://api.github.com/users/vietj/repos",
        "events_url": "https://api.github.com/users/vietj/events{/privacy}",
        "received_events_url": "https://api.github.com/users/vietj/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "parents": [
        {
            "sha": "e1a0dc959b03d9f9739a765f8ef01a5edcefef67",
            "url": "https://api.github.com/repos/vert-x3/vertx-web/commits/e1a0dc959b03d9f9739a765f8ef01a5edcefef67",
            "html_url": "https://github.com/vert-x3/vertx-web/commit/e1a0dc959b03d9f9739a765f8ef01a5edcefef67"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 4,
        "deletions": 3
    },
    "files": [
        {
            "sha": "7040419057521718f564be8af813828dd2120211",
            "filename": "vertx-web/src/main/java/io/vertx/ext/web/handler/impl/CSRFHandlerImpl.java",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vert-x3/vertx-web/blob/f42b193b15a29b772fc576b2d0f2497e7474a7e9/vertx-web%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fext%2Fweb%2Fhandler%2Fimpl%2FCSRFHandlerImpl.java",
            "raw_url": "https://github.com/vert-x3/vertx-web/raw/f42b193b15a29b772fc576b2d0f2497e7474a7e9/vertx-web%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fext%2Fweb%2Fhandler%2Fimpl%2FCSRFHandlerImpl.java",
            "contents_url": "https://api.github.com/repos/vert-x3/vertx-web/contents/vertx-web%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fext%2Fweb%2Fhandler%2Fimpl%2FCSRFHandlerImpl.java?ref=f42b193b15a29b772fc576b2d0f2497e7474a7e9",
            "patch": "@@ -106,9 +106,9 @@ private String generateToken() {\n     return saltPlusToken + \".\" + signature;\n   }\n \n-  private boolean validateToken(String header) {\n+  private boolean validateToken(String header, String cookie) {\n \n-    if (header == null) {\n+    if (header == null || cookie == null || !header.equals(cookie)) {\n       return false;\n     }\n \n@@ -168,7 +168,8 @@ public void handle(RoutingContext ctx) {\n       case DELETE:\n       case PATCH:\n         final String header = ctx.request().getHeader(headerName);\n-        if (validateToken(header == null ? ctx.request().getFormAttribute(headerName) : header)) {\n+        final String cookie = ctx.getCookie(cookieName).getValue();\n+        if (validateToken(header == null ? ctx.request().getFormAttribute(headerName) : header, cookie)) {\n           ctx.next();\n         } else {\n           forbidden(ctx);"
        }
    ]
}