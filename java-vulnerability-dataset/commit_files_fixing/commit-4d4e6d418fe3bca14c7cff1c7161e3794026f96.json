{
    "sha": "4d4e6d418fe3bca14c7cff1c7161e3794026f960",
    "node_id": "MDY6Q29tbWl0MTA3Mjg0NTo0ZDRlNmQ0MThmZTNiY2ExNGM3Y2ZmMWM3MTYxZTM3OTQwMjZmOTYw",
    "commit": {
        "author": {
            "name": "Jens Schauder",
            "email": "jschauder@pivotal.io",
            "date": "2019-03-21T10:39:28Z"
        },
        "committer": {
            "name": "Oliver Drotbohm",
            "email": "ogierke@pivotal.io",
            "date": "2019-04-01T08:40:10Z"
        },
        "message": "DATAJPA-1519 - Wildcard escaping in LIKE-queries.\n\nDerived queries with `contains`, `startWith` or `endsWith` predicates now use wildcard escaping in order to avoid selecting more then requested. A function `escape(String, String)` is made available in SpEL expressions as well for the same purpose.\n\nNote that annotated queries and derived queries with LIKE conditions don't get escaped because it is not clear if the use of wildcards in the argument is intended or not. Improved reference documentation accordingly.",
        "tree": {
            "sha": "383a5ef6b6cd92d06d1792eb66cae6dd842c4cce",
            "url": "https://api.github.com/repos/spring-projects/spring-data-jpa/git/trees/383a5ef6b6cd92d06d1792eb66cae6dd842c4cce"
        },
        "url": "https://api.github.com/repos/spring-projects/spring-data-jpa/git/commits/4d4e6d418fe3bca14c7cff1c7161e3794026f960",
        "comment_count": 0,
        "verification": {
            "verified": true,
            "reason": "valid",
            "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE3SOwfGzOVQk6tElQbkK1eHVD9pAFAlyhzmoACgkQbkK1eHVD\n9pBwVA/7BvdHuKyfYYa4BTD2pUA4dxBQKetTzH0Krr2fbec+VNphnngxelsppfEB\nfEbIOz3iJjJH7rgXKtkb+uNo4LKjUQtYh8sSwH2SBttTdZHlVsbTHN1jBSa9EMEU\np6nqgyll535pXeqchljd2z21DhNMTit/aWszi/03YTy5021X7BnFQa8p+TdOrBge\n8CBFKmshv1J7JJeEeQO4/IbxM/E/nu/pgIrJ1ZJlDMN0WH9vdNuA9G3xdmlYO/NQ\npBINfd1ERcQPULEVihb4LJu9kCB04HrN9Kynd+EHVlnDEVd7fiYfbVRS8jt4ntIn\nc6/b27iYSW+p0Kh/JFHtRsyxTDCV9DPQcAULWbKzTGSeLVJqVrCANe44CX0djcXk\nnLKzCRV2D0W3G1AzaWE27rD3Cqcr+JEx4eFHDt4K+tl0RlXhMkx0cvgtmk2NnOMi\nGkUGrQnVPWNTbMLtcX/iqvA9GQknPnHmui+49KlsQVum6wkP8AR8uJyzAayMJ9tg\n2VOsfy6Uno1xv+YWIG4Sh85Sf8Hlw3GeSBlWV17STkyAcxs9fcVrm+fMKByQaaPO\nMOiXLmKObzP8p53c7BcyTxdFcqZWLYsA9+mV6Ep3vWWKL8FgY+dkJ8i84g3tMQnU\n65KU/49Q0dYlZi69j6LTQCIBYD0Bdd2djBtgFFSUJ3IR4p/x2Es=\n=DadI\n-----END PGP SIGNATURE-----",
            "payload": "tree 383a5ef6b6cd92d06d1792eb66cae6dd842c4cce\nparent 7b189b8bc7cf44df3624c23f95384adec3d644aa\nauthor Jens Schauder <jschauder@pivotal.io> 1553164768 +0100\ncommitter Oliver Drotbohm <ogierke@pivotal.io> 1554108010 +0200\n\nDATAJPA-1519 - Wildcard escaping in LIKE-queries.\n\nDerived queries with `contains`, `startWith` or `endsWith` predicates now use wildcard escaping in order to avoid selecting more then requested. A function `escape(String, String)` is made available in SpEL expressions as well for the same purpose.\n\nNote that annotated queries and derived queries with LIKE conditions don't get escaped because it is not clear if the use of wildcards in the argument is intended or not. Improved reference documentation accordingly.\n",
            "verified_at": "2024-11-09T13:14:22Z"
        }
    },
    "url": "https://api.github.com/repos/spring-projects/spring-data-jpa/commits/4d4e6d418fe3bca14c7cff1c7161e3794026f960",
    "html_url": "https://github.com/spring-projects/spring-data-jpa/commit/4d4e6d418fe3bca14c7cff1c7161e3794026f960",
    "comments_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/commits/4d4e6d418fe3bca14c7cff1c7161e3794026f960/comments",
    "author": {
        "login": "schauder",
        "id": 136683,
        "node_id": "MDQ6VXNlcjEzNjY4Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/136683?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/schauder",
        "html_url": "https://github.com/schauder",
        "followers_url": "https://api.github.com/users/schauder/followers",
        "following_url": "https://api.github.com/users/schauder/following{/other_user}",
        "gists_url": "https://api.github.com/users/schauder/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/schauder/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/schauder/subscriptions",
        "organizations_url": "https://api.github.com/users/schauder/orgs",
        "repos_url": "https://api.github.com/users/schauder/repos",
        "events_url": "https://api.github.com/users/schauder/events{/privacy}",
        "received_events_url": "https://api.github.com/users/schauder/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "committer": {
        "login": "odrotbohm",
        "id": 128577,
        "node_id": "MDQ6VXNlcjEyODU3Nw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/128577?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/odrotbohm",
        "html_url": "https://github.com/odrotbohm",
        "followers_url": "https://api.github.com/users/odrotbohm/followers",
        "following_url": "https://api.github.com/users/odrotbohm/following{/other_user}",
        "gists_url": "https://api.github.com/users/odrotbohm/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/odrotbohm/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/odrotbohm/subscriptions",
        "organizations_url": "https://api.github.com/users/odrotbohm/orgs",
        "repos_url": "https://api.github.com/users/odrotbohm/repos",
        "events_url": "https://api.github.com/users/odrotbohm/events{/privacy}",
        "received_events_url": "https://api.github.com/users/odrotbohm/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "parents": [
        {
            "sha": "7b189b8bc7cf44df3624c23f95384adec3d644aa",
            "url": "https://api.github.com/repos/spring-projects/spring-data-jpa/commits/7b189b8bc7cf44df3624c23f95384adec3d644aa",
            "html_url": "https://github.com/spring-projects/spring-data-jpa/commit/7b189b8bc7cf44df3624c23f95384adec3d644aa"
        }
    ],
    "stats": {
        "total": 297,
        "additions": 244,
        "deletions": 53
    },
    "files": [
        {
            "sha": "1255f0c913ae0ea2a74284535b9a801399475d4b",
            "filename": "pom.xml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/pom.xml",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/pom.xml",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/pom.xml?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -211,7 +211,7 @@\n \t\t<dependency>\n \t\t\t<groupId>org.hsqldb</groupId>\n \t\t\t<artifactId>hsqldb</artifactId>\n-\t\t\t<version>2.2.8</version>\n+\t\t\t<version>2.4.1</version>\n \t\t\t<scope>test</scope>\n \t\t</dependency>\n "
        },
        {
            "sha": "54d239c73cec7c713a8a2bd314bf3ad2d3720194",
            "filename": "src/main/asciidoc/jpa.adoc",
            "status": "modified",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fasciidoc%2Fjpa.adoc",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fasciidoc%2Fjpa.adoc",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fasciidoc%2Fjpa.adoc?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -123,6 +123,11 @@ This section describes the various ways to create a query with Spring Data JPA.\n \n The JPA module supports defining a query manually as a String or having it being derived from the method name.\n \n+Derived queries with the predicates `IsStartingWith`, `StartingWith`, `StartsWith`, IsEndingWith\", `EndingWith`, `EndsWith`,\n+`IsNotContaining`, `NotContaining`, `NotContains`, `IsContaining`, `Containing`, `Contains` the respective arguments for these queries will get sanitized.\n+This means if the arguments actually contain characters recognized by `LIKE` as wildcards these will get escaped so they match only as literals.\n+Compare with <<jpa.query.spel-expressions>>.\n+\n ==== Declared Queries\n Although getting a query derived from the method name is quite convenient, one might face the situation in which either the method name parser does not support the keyword one wants to use or the method name would get unnecessarily ugly. So you can either use JPA named queries through a naming convention (see <<jpa.query-methods.named-queries>> for more information) or rather annotate your query method with `@Query` (see <<jpa.query-methods.at-query>> for details).\n \n@@ -427,6 +432,51 @@ public interface ConcreteRepository\n \n In the preceding example, the `MappedTypeRepository` interface is the common parent interface for a few domain types extending `AbstractMappedType`. It also defines the generic `findAllByAttribute(\u2026)` method, which can be used on instances of the specialized repository interfaces. If you now invoke `findByAllAttribute(\u2026)` on `ConcreteRepository`, the query becomes `select t from ConcreteType t where t.attribute = ?1`.\n \n+SpEL expressions to manipulate arguments may also be used to manipulate method arguments.\n+In these SpEL expressions the entity name is not available, but the arguments are.\n+They can be accessed by name or index as demonstrated in the following example.\n+\n+.Using SpEL expressions in repository query methods - accessing arguments.\n+====\n+[source, java]\n+----\n+@Query(\"select u from User u where u.firstname = ?1 and u.firstname=?#{[0]} and u.emailAddress = ?#{principal.emailAddress}\")\n+List<User> findByFirstnameAndCurrentUserWithCustomQuery(String firstname);\n+----\n+====\n+\n+For `like`-conditions one often wants to appen `%` to the beginning or the end of a String valued parameter.\n+This can be done by appending or prefixing a bind parameter marker or a SpEL expression with `%`.\n+Again the following example demonstrates this.\n+\n+.Using SpEL expressions in repository query methods - wildcard shortcut.\n+====\n+[source, java]\n+----\n+@Query(\"select u from User u where u.lastname like %:#{[0]}% and u.lastname like %:lastname%\")\n+List<User> findByLastnameWithSpelExpression(@Param(\"lastname\") String lastname);\n+----\n+====\n+\n+When using `like`-conditions with values that are coming from a not secure source the values should be sanitized so they can't contain any wildcards and thereby allow attackers to select more data than they should be able to.\n+For this purpose the the `escape(String, String)` method is made available in the SpEL context.\n+It prefixes all instances of `_` and `%` in the first argument with the single character from the second argument.\n+In combination with the `escape` clause of the `like` expression available in JPQL and standard SQL this allows easy cleaning of bind parameters.\n+\n+\n+.Using SpEL expressions in repository query methods - sanitizing input values.\n+====\n+[source, java]\n+----\n+@Query(\"select u from User u where u.firstname like %?#{#escape([0],'#')}% escape '#'\")\n+List<User> findContainingEscaped(String namePart);\n+----\n+====\n+\n+Given this method declaration in an repository interface `findContainingEscaped(\"Peter_\")\" will find `Peter_Parker` but not `Peter Parker`.\n+Note that the method `escape(String, String)` available in the SpEL context will only escape the SQL and JPQL standard wildcards `_` and `%`.\n+If the underlying database or the JPA implementation supports additional wildcards these will not get escaped.\n+\n [[jpa.modifying-queries]]\n === Modifying Queries\n "
        },
        {
            "sha": "06c82afc409bd47857a6d85ea0963b0856f52f91",
            "filename": "src/main/java/org/springframework/data/jpa/repository/config/EnableJpaRepositories.java",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fconfig%2FEnableJpaRepositories.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fconfig%2FEnableJpaRepositories.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fconfig%2FEnableJpaRepositories.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -150,4 +150,12 @@\n \t * @return whether to enable default transactions, defaults to {@literal true}.\n \t */\n \tboolean enableDefaultTransactions() default true;\n+\n+\t/**\n+\t * Configures what character is used to escape the wildcards {@literal _} and {@literal %} in derived queries with\n+\t * {@literal contains}, {@literal startsWith} or {@literal endsWith} clauses.\n+\t * \n+\t * @return a single character used for escaping.\n+\t */\n+\tchar escapeCharacter() default '\\\\';\n }"
        },
        {
            "sha": "90cced9abbbc1dafba54a4eb4d0761d68a5ea7d6",
            "filename": "src/main/java/org/springframework/data/jpa/repository/config/JpaRepositoryConfigExtension.java",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fconfig%2FJpaRepositoryConfigExtension.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fconfig%2FJpaRepositoryConfigExtension.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fconfig%2FJpaRepositoryConfigExtension.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -132,9 +132,22 @@ public void postProcess(BeanDefinitionBuilder builder, RepositoryConfigurationSo\n \t\tOptional<String> transactionManagerRef = source.getAttribute(\"transactionManagerRef\");\n \t\tbuilder.addPropertyValue(\"transactionManager\", transactionManagerRef.orElse(DEFAULT_TRANSACTION_MANAGER_BEAN_NAME));\n \t\tbuilder.addPropertyValue(\"entityManager\", getEntityManagerBeanDefinitionFor(source, source.getSource()));\n+\t\tbuilder.addPropertyValue(\"escapeCharacter\", getEscapeCharacter(source).orElse('\\\\'));\n \t\tbuilder.addPropertyReference(\"mappingContext\", JPA_MAPPING_CONTEXT_BEAN_NAME);\n \t}\n \n+\t/**\n+\t * XML configurations do not support {@link Character} values. This method catches the exception thrown and returns an {@link Optional#empty()} instead.\n+\t */\n+\tprivate static Optional<Character> getEscapeCharacter(RepositoryConfigurationSource source) {\n+\n+\t\ttry {\n+\t\t\treturn source.getAttribute(\"escapeCharacter\", Character.class);\n+\t\t} catch (IllegalArgumentException ___) {\n+\t\t\treturn Optional.empty();\n+\t\t}\n+\t}\n+\n \t/*\n \t * (non-Javadoc)\n \t * @see org.springframework.data.repository.config.RepositoryConfigurationExtensionSupport#postProcess(org.springframework.beans.factory.support.BeanDefinitionBuilder, org.springframework.data.repository.config.AnnotationRepositoryConfigurationSource)"
        },
        {
            "sha": "1e5955fce6f7dca086db91a5ceaeb635ed6ee63e",
            "filename": "src/main/java/org/springframework/data/jpa/repository/query/JpaQueryCreator.java",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaQueryCreator.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaQueryCreator.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaQueryCreator.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -36,6 +36,7 @@\n \n import org.springframework.data.domain.Sort;\n import org.springframework.data.jpa.repository.query.ParameterMetadataProvider.ParameterMetadata;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.data.mapping.PropertyPath;\n import org.springframework.data.repository.query.ReturnedType;\n import org.springframework.data.repository.query.parser.AbstractQueryCreator;\n@@ -62,6 +63,7 @@ public class JpaQueryCreator extends AbstractQueryCreator<CriteriaQuery<? extend\n \tprivate final ParameterMetadataProvider provider;\n \tprivate final ReturnedType returnedType;\n \tprivate final PartTree tree;\n+\tprivate final EscapeCharacter escape;\n \n \t/**\n \t * Create a new {@link JpaQueryCreator}.\n@@ -77,13 +79,14 @@ public JpaQueryCreator(PartTree tree, ReturnedType type, CriteriaBuilder builder\n \t\tsuper(tree);\n \t\tthis.tree = tree;\n \n-\t\tCriteriaQuery<? extends Object> criteriaQuery = createCriteriaQuery(builder, type);\n+\t\tCriteriaQuery<?> criteriaQuery = createCriteriaQuery(builder, type);\n \n \t\tthis.builder = builder;\n \t\tthis.query = criteriaQuery.distinct(tree.isDistinct());\n \t\tthis.root = query.from(type.getDomainType());\n \t\tthis.provider = provider;\n \t\tthis.returnedType = type;\n+\t\tthis.escape = provider.getEscape();\n \t}\n \n \t/**\n@@ -289,7 +292,7 @@ public Predicate build() {\n \t\t\t\t\tExpression<String> stringPath = getTypedPath(root, part);\n \t\t\t\t\tExpression<String> propertyExpression = upperIfIgnoreCase(stringPath);\n \t\t\t\t\tExpression<String> parameterExpression = upperIfIgnoreCase(provider.next(part, String.class).getExpression());\n-\t\t\t\t\tPredicate like = builder.like(propertyExpression, parameterExpression);\n+\t\t\t\t\tPredicate like = builder.like(propertyExpression, parameterExpression, escape.getValue());\n \t\t\t\t\treturn type.equals(NOT_LIKE) || type.equals(NOT_CONTAINING) ? like.not() : like;\n \t\t\t\tcase TRUE:\n \t\t\t\t\tExpression<Boolean> truePath = getTypedPath(root, part);"
        },
        {
            "sha": "cbfa2186965c39f66deb727583a655f66565f66c",
            "filename": "src/main/java/org/springframework/data/jpa/repository/query/JpaQueryLookupStrategy.java",
            "status": "modified",
            "additions": 11,
            "deletions": 5,
            "changes": 16,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaQueryLookupStrategy.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaQueryLookupStrategy.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaQueryLookupStrategy.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -22,6 +22,7 @@\n import org.springframework.data.jpa.provider.PersistenceProvider;\n import org.springframework.data.jpa.provider.QueryExtractor;\n import org.springframework.data.jpa.repository.Query;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.data.projection.ProjectionFactory;\n import org.springframework.data.repository.core.NamedQueries;\n import org.springframework.data.repository.core.RepositoryMetadata;\n@@ -91,16 +92,19 @@ public final RepositoryQuery resolveQuery(Method method, RepositoryMetadata meta\n \tprivate static class CreateQueryLookupStrategy extends AbstractQueryLookupStrategy {\n \n \t\tprivate final PersistenceProvider persistenceProvider;\n+\t\tprivate final EscapeCharacter escape;\n \n-\t\tpublic CreateQueryLookupStrategy(EntityManager em, QueryExtractor extractor) {\n+\t\tpublic CreateQueryLookupStrategy(EntityManager em, QueryExtractor extractor, EscapeCharacter escape) {\n \n \t\t\tsuper(em, extractor);\n+\n \t\t\tthis.persistenceProvider = PersistenceProvider.fromEntityManager(em);\n+\t\t\tthis.escape = escape;\n \t\t}\n \n \t\t@Override\n \t\tprotected RepositoryQuery resolveQuery(JpaQueryMethod method, EntityManager em, NamedQueries namedQueries) {\n-\t\t\treturn new PartTreeJpaQuery(method, em, persistenceProvider);\n+\t\t\treturn new PartTreeJpaQuery(method, em, persistenceProvider, escape);\n \t\t}\n \t}\n \n@@ -217,22 +221,24 @@ protected RepositoryQuery resolveQuery(JpaQueryMethod method, EntityManager em,\n \t * @param key may be {@literal null}.\n \t * @param extractor must not be {@literal null}.\n \t * @param evaluationContextProvider must not be {@literal null}.\n+\t * @param escape\n \t * @return\n \t */\n \tpublic static QueryLookupStrategy create(EntityManager em, @Nullable Key key, QueryExtractor extractor,\n-\t\t\tEvaluationContextProvider evaluationContextProvider) {\n+\t\t\tEvaluationContextProvider evaluationContextProvider, EscapeCharacter escape) {\n \n \t\tAssert.notNull(em, \"EntityManager must not be null!\");\n \t\tAssert.notNull(extractor, \"QueryExtractor must not be null!\");\n \t\tAssert.notNull(evaluationContextProvider, \"EvaluationContextProvider must not be null!\");\n \n \t\tswitch (key != null ? key : Key.CREATE_IF_NOT_FOUND) {\n \t\t\tcase CREATE:\n-\t\t\t\treturn new CreateQueryLookupStrategy(em, extractor);\n+\t\t\t\treturn new CreateQueryLookupStrategy(em, extractor, escape);\n \t\t\tcase USE_DECLARED_QUERY:\n \t\t\t\treturn new DeclaredQueryLookupStrategy(em, extractor, evaluationContextProvider);\n \t\t\tcase CREATE_IF_NOT_FOUND:\n-\t\t\t\treturn new CreateIfNotFoundQueryLookupStrategy(em, extractor, new CreateQueryLookupStrategy(em, extractor),\n+\t\t\t\treturn new CreateIfNotFoundQueryLookupStrategy(em, extractor,\n+\t\t\t\t\t\tnew CreateQueryLookupStrategy(em, extractor, escape),\n \t\t\t\t\t\tnew DeclaredQueryLookupStrategy(em, extractor, evaluationContextProvider));\n \t\t\tdefault:\n \t\t\t\tthrow new IllegalArgumentException(String.format(\"Unsupported query lookup strategy %s!\", key));"
        },
        {
            "sha": "51e26cc83d388b631122ed3b8e5805136b040b93",
            "filename": "src/main/java/org/springframework/data/jpa/repository/query/ParameterMetadataProvider.java",
            "status": "modified",
            "additions": 23,
            "deletions": 11,
            "changes": 34,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterMetadataProvider.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterMetadataProvider.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterMetadataProvider.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -27,6 +27,7 @@\n import javax.persistence.criteria.ParameterExpression;\n \n import org.springframework.data.jpa.provider.PersistenceProvider;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.data.repository.query.Parameter;\n import org.springframework.data.repository.query.Parameters;\n import org.springframework.data.repository.query.ParametersParameterAccessor;\n@@ -54,6 +55,7 @@ class ParameterMetadataProvider {\n \tprivate final List<ParameterMetadata<?>> expressions;\n \tprivate final @Nullable Iterator<Object> bindableParameterValues;\n \tprivate final PersistenceProvider persistenceProvider;\n+\tprivate final EscapeCharacter escape;\n \n \t/**\n \t * Creates a new {@link ParameterMetadataProvider} from the given {@link CriteriaBuilder} and\n@@ -63,22 +65,24 @@ class ParameterMetadataProvider {\n \t * @param builder must not be {@literal null}.\n \t * @param accessor must not be {@literal null}.\n \t * @param provider must not be {@literal null}.\n+\t * @param escape\n \t */\n \tpublic ParameterMetadataProvider(CriteriaBuilder builder, ParametersParameterAccessor accessor,\n-\t\t\tPersistenceProvider provider) {\n-\t\tthis(builder, accessor.iterator(), accessor.getParameters(), provider);\n+\t\t\t\t\t\t\t\t\t PersistenceProvider provider, EscapeCharacter escape) {\n+\t\tthis(builder, accessor.iterator(), accessor.getParameters(), provider, escape);\n \t}\n \n \t/**\n \t * Creates a new {@link ParameterMetadataProvider} from the given {@link CriteriaBuilder} and {@link Parameters} with\n \t * support for parameter value customizations via {@link PersistenceProvider}.\n \t * \n-\t * @param builder must not be {@literal null}.\n+\t *  @param builder must not be {@literal null}.\n \t * @param parameters must not be {@literal null}.\n \t * @param provider must not be {@literal null}.\n+\t * @param escape\n \t */\n-\tpublic ParameterMetadataProvider(CriteriaBuilder builder, Parameters<?, ?> parameters, PersistenceProvider provider) {\n-\t\tthis(builder, null, parameters, provider);\n+\tpublic ParameterMetadataProvider(CriteriaBuilder builder, Parameters<?, ?> parameters, PersistenceProvider provider, EscapeCharacter escape) {\n+\t\tthis(builder, null, parameters, provider, escape);\n \t}\n \n \t/**\n@@ -90,9 +94,10 @@ public ParameterMetadataProvider(CriteriaBuilder builder, Parameters<?, ?> param\n \t * @param bindableParameterValues may be {@literal null}.\n \t * @param parameters must not be {@literal null}.\n \t * @param provider must not be {@literal null}.\n+\t * @param escape\n \t */\n \tprivate ParameterMetadataProvider(CriteriaBuilder builder, @Nullable Iterator<Object> bindableParameterValues,\n-\t\t\tParameters<?, ?> parameters, PersistenceProvider provider) {\n+\t\t\t\t\t\t\t\t\t  Parameters<?, ?> parameters, PersistenceProvider provider, EscapeCharacter escape) {\n \n \t\tAssert.notNull(builder, \"CriteriaBuilder must not be null!\");\n \t\tAssert.notNull(parameters, \"Parameters must not be null!\");\n@@ -103,6 +108,7 @@ private ParameterMetadataProvider(CriteriaBuilder builder, @Nullable Iterator<Ob\n \t\tthis.expressions = new ArrayList<>();\n \t\tthis.bindableParameterValues = bindableParameterValues;\n \t\tthis.persistenceProvider = provider;\n+\t\tthis.escape = escape;\n \t}\n \n \t/**\n@@ -170,12 +176,16 @@ private <T> ParameterMetadata<T> next(Part part, Class<T> type, Parameter parame\n \n \t\tObject value = bindableParameterValues == null ? ParameterMetadata.PLACEHOLDER : bindableParameterValues.next();\n \n-\t\tParameterMetadata<T> metadata = new ParameterMetadata<>(expression, part.getType(), value, persistenceProvider);\n+\t\tParameterMetadata<T> metadata = new ParameterMetadata<>(expression, part.getType(), value, persistenceProvider, escape);\n \t\texpressions.add(metadata);\n \n \t\treturn metadata;\n \t}\n \n+\tEscapeCharacter getEscape() {\n+\t\treturn escape;\n+\t}\n+\n \t/**\n \t * @author Oliver Gierke\n \t * @author Thomas Darimont\n@@ -188,16 +198,18 @@ static class ParameterMetadata<T> {\n \t\tprivate final Type type;\n \t\tprivate final ParameterExpression<T> expression;\n \t\tprivate final PersistenceProvider persistenceProvider;\n+\t\tprivate final EscapeCharacter escape;\n \n \t\t/**\n \t\t * Creates a new {@link ParameterMetadata}.\n \t\t */\n \t\tpublic ParameterMetadata(ParameterExpression<T> expression, Type type, @Nullable Object value,\n-\t\t\t\tPersistenceProvider provider) {\n+\t\t\t\t\t\t\t\t PersistenceProvider provider, EscapeCharacter escape) {\n \n \t\t\tthis.expression = expression;\n \t\t\tthis.persistenceProvider = provider;\n \t\t\tthis.type = value == null && Type.SIMPLE_PROPERTY.equals(type) ? Type.IS_NULL : type;\n+\t\t\tthis.escape = escape;\n \t\t}\n \n \t\t/**\n@@ -232,12 +244,12 @@ public Object prepare(Object value) {\n \n \t\t\t\tswitch (type) {\n \t\t\t\t\tcase STARTING_WITH:\n-\t\t\t\t\t\treturn String.format(\"%s%%\", value.toString());\n+\t\t\t\t\t\treturn String.format(\"%s%%\", escape.escape(value.toString()));\n \t\t\t\t\tcase ENDING_WITH:\n-\t\t\t\t\t\treturn String.format(\"%%%s\", value.toString());\n+\t\t\t\t\t\treturn String.format(\"%%%s\", escape.escape(value.toString()));\n \t\t\t\t\tcase CONTAINING:\n \t\t\t\t\tcase NOT_CONTAINING:\n-\t\t\t\t\t\treturn String.format(\"%%%s%%\", value.toString());\n+\t\t\t\t\t\treturn String.format(\"%%%s%%\", escape.escape(value.toString()));\n \t\t\t\t\tdefault:\n \t\t\t\t\t\treturn value;\n \t\t\t\t}"
        },
        {
            "sha": "9f628ee3935f0b85307164a56a96da1ddc0b1b86",
            "filename": "src/main/java/org/springframework/data/jpa/repository/query/PartTreeJpaQuery.java",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FPartTreeJpaQuery.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FPartTreeJpaQuery.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FPartTreeJpaQuery.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -29,6 +29,7 @@\n import org.springframework.data.jpa.repository.query.JpaQueryExecution.DeleteExecution;\n import org.springframework.data.jpa.repository.query.JpaQueryExecution.ExistsExecution;\n import org.springframework.data.jpa.repository.query.ParameterMetadataProvider.ParameterMetadata;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.data.repository.query.ParametersParameterAccessor;\n import org.springframework.data.repository.query.ResultProcessor;\n import org.springframework.data.repository.query.ReturnedType;\n@@ -53,19 +54,22 @@ public class PartTreeJpaQuery extends AbstractJpaQuery {\n \tprivate final QueryPreparer query;\n \tprivate final QueryPreparer countQuery;\n \tprivate final EntityManager em;\n+\tprivate final EscapeCharacter escape;\n \n \t/**\n \t * Creates a new {@link PartTreeJpaQuery}.\n \t * \n \t * @param method must not be {@literal null}.\n \t * @param em must not be {@literal null}.\n \t * @param persistenceProvider must not be {@literal null}.\n+\t * @param escape\n \t */\n-\tPartTreeJpaQuery(JpaQueryMethod method, EntityManager em, PersistenceProvider persistenceProvider) {\n+\tPartTreeJpaQuery(JpaQueryMethod method, EntityManager em, PersistenceProvider persistenceProvider, EscapeCharacter escape) {\n \n \t\tsuper(method, em);\n \n \t\tthis.em = em;\n+\t\tthis.escape = escape;\n \t\tClass<?> domainClass = method.getEntityInformation().getJavaType();\n \t\tthis.parameters = method.getParameters();\n \n@@ -226,8 +230,8 @@ protected JpaQueryCreator createCreator(PersistenceProvider persistenceProvider,\n \t\t\tCriteriaBuilder builder = entityManager.getCriteriaBuilder();\n \n \t\t\tParameterMetadataProvider provider = accessor\n-\t\t\t\t\t.map(it -> new ParameterMetadataProvider(builder, it, persistenceProvider))//\n-\t\t\t\t\t.orElseGet(() -> new ParameterMetadataProvider(builder, parameters, persistenceProvider));\n+\t\t\t\t\t.map(it -> new ParameterMetadataProvider(builder, it, persistenceProvider, escape))//\n+\t\t\t\t\t.orElseGet(() -> new ParameterMetadataProvider(builder, parameters, persistenceProvider, escape));\n \n \t\t\tResultProcessor processor = getQueryMethod().getResultProcessor();\n \t\t\tReturnedType returnedType = accessor.map(processor::withDynamicProjection)//\n@@ -280,8 +284,8 @@ protected JpaQueryCreator createCreator(PersistenceProvider persistenceProvider,\n \t\t\tCriteriaBuilder builder = entityManager.getCriteriaBuilder();\n \n \t\t\tParameterMetadataProvider provider = accessor\n-\t\t\t\t\t.map(it -> new ParameterMetadataProvider(builder, it, persistenceProvider))//\n-\t\t\t\t\t.orElseGet(() -> new ParameterMetadataProvider(builder, parameters, persistenceProvider));\n+\t\t\t\t\t.map(it -> new ParameterMetadataProvider(builder, it, persistenceProvider, escape))//\n+\t\t\t\t\t.orElseGet(() -> new ParameterMetadataProvider(builder, parameters, persistenceProvider, escape));\n \n \t\t\treturn new JpaCountQueryCreator(tree, getQueryMethod().getResultProcessor().getReturnedType(), builder, provider);\n \t\t}"
        },
        {
            "sha": "f1923664fbc1a41e255be44555ac84d6dd7d1a2b",
            "filename": "src/main/java/org/springframework/data/jpa/repository/query/QueryParameterSetterFactory.java",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FQueryParameterSetterFactory.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FQueryParameterSetterFactory.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FQueryParameterSetterFactory.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -15,6 +15,7 @@\n  */\n package org.springframework.data.jpa.repository.query;\n \n+import java.lang.reflect.Method;\n import java.util.List;\n import java.util.function.Function;\n \n@@ -28,11 +29,13 @@\n import org.springframework.data.repository.query.EvaluationContextProvider;\n import org.springframework.data.repository.query.Parameter;\n import org.springframework.data.repository.query.Parameters;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.expression.EvaluationContext;\n import org.springframework.expression.Expression;\n import org.springframework.expression.spel.standard.SpelExpressionParser;\n import org.springframework.lang.Nullable;\n import org.springframework.util.Assert;\n+import org.springframework.util.ReflectionUtils;\n \n /**\n  * Encapsulates different strategies for the creation of a {@link QueryParameterSetter} from a {@link Query} and a\n@@ -174,6 +177,11 @@ public QueryParameterSetter create(ParameterBinding binding, DeclaredQuery decla\n \t\tprivate Object evaluateExpression(Expression expression, Object[] values) {\n \n \t\t\tEvaluationContext context = evaluationContextProvider.getEvaluationContext(parameters, values);\n+\t\t\tMethod escapeMethod = ReflectionUtils.findMethod(EscapeCharacter.class, \"escape\", String.class, String.class);\n+\n+\t\t\tAssert.notNull(escapeMethod, \"Escape method must not be null.\");\n+\n+\t\t\tcontext.setVariable(\"escape\", escapeMethod);\n \t\t\treturn expression.getValue(context, Object.class);\n \t\t}\n \t}"
        },
        {
            "sha": "21d9b107dd99d9e3dc4a9faef12bc7b9383689fb",
            "filename": "src/main/java/org/springframework/data/jpa/repository/support/EscapeCharacter.java",
            "status": "added",
            "additions": 47,
            "deletions": 0,
            "changes": 47,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsupport%2FEscapeCharacter.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsupport%2FEscapeCharacter.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsupport%2FEscapeCharacter.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright 2019 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.springframework.data.jpa.repository.support;\n+\n+import lombok.Value;\n+\n+import org.springframework.util.Assert;\n+\n+/**\n+ * A Value-class encapsulating an escape character for LIKE queries and the actually usage of it in escaping Strings.\n+ *\n+ * @author Jens Schauder\n+ */\n+@Value(staticConstructor = \"of\")\n+public class EscapeCharacter {\n+\tchar value;\n+\n+\tpublic String escape(String value) {\n+\n+\t\tAssert.notNull(value, \"Value must be not null.\");\n+\n+\t\treturn value.replace(\"_\", value + \"_\").replace(\"%\", value + \"%\");\n+\t}\n+\n+\t// used for SpEL expressions\n+\tstatic String escape(String value, String escape) {\n+\n+\t\tAssert.hasText(escape, \"escape must be a sinlge character String.\");\n+\t\tchar[] chars = escape.toCharArray();\n+\t\tAssert.isTrue(chars.length == 1, \"escape must be a single character String.\");\n+\n+\t\treturn EscapeCharacter.of(chars[0]).escape(value);\n+\t}\n+}"
        },
        {
            "sha": "5534d446df1b9c3be61cccea7bf3f90b3ea3a8b1",
            "filename": "src/main/java/org/springframework/data/jpa/repository/support/JpaRepositoryFactory.java",
            "status": "modified",
            "additions": 21,
            "deletions": 9,
            "changes": 30,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsupport%2FJpaRepositoryFactory.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsupport%2FJpaRepositoryFactory.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsupport%2FJpaRepositoryFactory.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -48,7 +48,7 @@\n \n /**\n  * JPA specific generic repository factory.\n- * \n+ *\n  * @author Oliver Gierke\n  * @author Mark Paluch\n  * @author Christoph Strobl\n@@ -60,9 +60,11 @@ public class JpaRepositoryFactory extends RepositoryFactorySupport {\n \tprivate final QueryExtractor extractor;\n \tprivate final CrudMethodMetadataPostProcessor crudMethodMetadataPostProcessor;\n \n+\tprivate EscapeCharacter escapeCharacter = EscapeCharacter.of('\\\\');\n+\n \t/**\n \t * Creates a new {@link JpaRepositoryFactory}.\n-\t * \n+\t *\n \t * @param entityManager must not be {@literal null}\n \t */\n \tpublic JpaRepositoryFactory(EntityManager entityManager) {\n@@ -80,7 +82,7 @@ public JpaRepositoryFactory(EntityManager entityManager) {\n \t\t}\n \t}\n \n-\t/* \n+\t/*\n \t * (non-Javadoc)\n \t * @see org.springframework.data.repository.core.support.RepositoryFactorySupport#setBeanClassLoader(java.lang.ClassLoader)\n \t */\n@@ -91,6 +93,15 @@ public void setBeanClassLoader(ClassLoader classLoader) {\n \t\tthis.crudMethodMetadataPostProcessor.setBeanClassLoader(classLoader);\n \t}\n \n+\t/**\n+\t * Configures the escape character to be used for like-expressions created for derived queries.\n+\t *\n+\t * @param escapeCharacter a character used for escaping in certain like expressions.\n+\t */\n+\tpublic void setEscapeCharacter(EscapeCharacter escapeCharacter) {\n+\t\tthis.escapeCharacter = escapeCharacter;\n+\t}\n+\n \t/*\n \t * (non-Javadoc)\n \t * @see org.springframework.data.repository.core.support.RepositoryFactorySupport#getTargetRepository(org.springframework.data.repository.core.RepositoryMetadata)\n@@ -106,7 +117,7 @@ protected Object getTargetRepository(RepositoryInformation information) {\n \n \t/**\n \t * Callback to create a {@link JpaRepository} instance with the given {@link EntityManager}\n-\t * \n+\t *\n \t * @param <T>\n \t * @param <ID>\n \t * @param entityManager\n@@ -150,7 +161,7 @@ protected ProjectionFactory getProjectionFactory(ClassLoader classLoader, BeanFa\n \n \t/**\n \t * Returns whether the given repository interface requires a QueryDsl specific implementation to be chosen.\n-\t * \n+\t *\n \t * @param repositoryInterface\n \t * @return\n \t */\n@@ -159,14 +170,15 @@ private boolean isQueryDslExecutor(Class<?> repositoryInterface) {\n \t\treturn QUERY_DSL_PRESENT && QuerydslPredicateExecutor.class.isAssignableFrom(repositoryInterface);\n \t}\n \n-\t/* \n+\t/*\n \t * (non-Javadoc)\n \t * @see org.springframework.data.repository.core.support.RepositoryFactorySupport#getQueryLookupStrategy(org.springframework.data.repository.query.QueryLookupStrategy.Key, org.springframework.data.repository.query.EvaluationContextProvider)\n \t */\n \t@Override\n \tprotected Optional<QueryLookupStrategy> getQueryLookupStrategy(@Nullable Key key,\n \t\t\tEvaluationContextProvider evaluationContextProvider) {\n-\t\treturn Optional.of(JpaQueryLookupStrategy.create(entityManager, key, extractor, evaluationContextProvider));\n+\t\treturn Optional\n+\t\t\t\t.of(JpaQueryLookupStrategy.create(entityManager, key, extractor, evaluationContextProvider, escapeCharacter));\n \t}\n \n \t/*\n@@ -201,7 +213,7 @@ private static class EclipseLinkProjectionQueryCreationListener implements Query\n \n \t\t/**\n \t\t * Creates a new {@link EclipseLinkProjectionQueryCreationListener} for the given {@link EntityManager}.\n-\t\t * \n+\t\t *\n \t\t * @param em must not be {@literal null}.\n \t\t */\n \t\tpublic EclipseLinkProjectionQueryCreationListener(EntityManager em) {\n@@ -211,7 +223,7 @@ public EclipseLinkProjectionQueryCreationListener(EntityManager em) {\n \t\t\tthis.metamodel = JpaMetamodel.of(em.getMetamodel());\n \t\t}\n \n-\t\t/* \n+\t\t/*\n \t\t * (non-Javadoc)\n \t\t * @see org.springframework.data.repository.core.support.QueryCreationListener#onCreation(org.springframework.data.repository.query.RepositoryQuery)\n \t\t */"
        },
        {
            "sha": "2595d79996f6d240b3917edbe1ad21bea3da532a",
            "filename": "src/main/java/org/springframework/data/jpa/repository/support/JpaRepositoryFactoryBean.java",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsupport%2FJpaRepositoryFactoryBean.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsupport%2FJpaRepositoryFactoryBean.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Fmain%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsupport%2FJpaRepositoryFactoryBean.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -38,7 +38,6 @@ public class JpaRepositoryFactoryBean<T extends Repository<S, ID>, S, ID>\n \t\textends TransactionalRepositoryFactoryBeanSupport<T, S, ID> {\n \n \tprivate @Nullable EntityManager entityManager;\n-\n \t/**\n \t * Creates a new {@link JpaRepositoryFactoryBean} for the given repository interface.\n \t *\n@@ -88,7 +87,11 @@ protected RepositoryFactorySupport doCreateRepositoryFactory() {\n \t * @return\n \t */\n \tprotected RepositoryFactorySupport createRepositoryFactory(EntityManager entityManager) {\n-\t\treturn new JpaRepositoryFactory(entityManager);\n+\n+\t\tJpaRepositoryFactory jpaRepositoryFactory = new JpaRepositoryFactory(entityManager);\n+\t\tjpaRepositoryFactory.setEscapeCharacter(escapeCharacter);\n+\n+\t\treturn jpaRepositoryFactory;\n \t}\n \n \t/*\n@@ -101,4 +104,9 @@ public void afterPropertiesSet() {\n \t\tAssert.state(entityManager != null,\"EntityManager must not be null!\");\n \t\tsuper.afterPropertiesSet();\n \t}\n+\n+\tpublic void setEscapeCharacter(char escapeCharacter) {\n+\n+\t\tthis.escapeCharacter = EscapeCharacter.of(escapeCharacter);\n+\t}\n }"
        },
        {
            "sha": "1991c582cc7c69c3f51ba937c63313fa3c125491",
            "filename": "src/test/java/org/springframework/data/jpa/repository/UserRepositoryFinderTests.java",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2FUserRepositoryFinderTests.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2FUserRepositoryFinderTests.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2FUserRepositoryFinderTests.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -198,6 +198,16 @@ public void executesMethodWithNotContainingOnStringCorrectly() {\n \t\tassertThat(userRepository.findByLastnameNotContaining(\"u\"), containsInAnyOrder(dave, oliver));\n \t}\n \n+\t@Test // DATAJPA-1519\n+\tpublic void parametersForContainsGetProperlyEscaped() {\n+\t\tassertThat(userRepository.findByFirstnameContaining(\"liv%\"), iterableWithSize(0));\n+\t}\n+\n+\t@Test // DATAJPA-1519\n+\tpublic void escapingInLikeSpels() {\n+\t\tassertThat(userRepository.findContainingEscaped(\"att_\"), iterableWithSize(0));\n+\t}\n+\n \t@Test // DATAJPA-829\n \tpublic void translatesContainsToMemberOf() {\n "
        },
        {
            "sha": "4e48330f2fcd6dc640c2a05e07e34ebf8174f011",
            "filename": "src/test/java/org/springframework/data/jpa/repository/query/JpaCountQueryCreatorIntegrationTests.java",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaCountQueryCreatorIntegrationTests.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaCountQueryCreatorIntegrationTests.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaCountQueryCreatorIntegrationTests.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -31,6 +31,7 @@\n import org.springframework.data.jpa.domain.sample.User;\n import org.springframework.data.jpa.provider.HibernateUtils;\n import org.springframework.data.jpa.provider.PersistenceProvider;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.data.projection.SpelAwareProxyProjectionFactory;\n import org.springframework.data.repository.Repository;\n import org.springframework.data.repository.core.support.AbstractRepositoryMetadata;\n@@ -60,7 +61,7 @@ public void distinctFlagOnCountQueryIssuesCountDistinct() throws Exception {\n \n \t\tPartTree tree = new PartTree(\"findDistinctByRolesIn\", User.class);\n \t\tParameterMetadataProvider metadataProvider = new ParameterMetadataProvider(entityManager.getCriteriaBuilder(),\n-\t\t\t\tqueryMethod.getParameters(), provider);\n+\t\t\t\tqueryMethod.getParameters(), provider, EscapeCharacter.of('\\\\'));\n \n \t\tJpaCountQueryCreator creator = new JpaCountQueryCreator(tree, queryMethod.getResultProcessor().getReturnedType(),\n \t\t\t\tentityManager.getCriteriaBuilder(), metadataProvider);"
        },
        {
            "sha": "f038b8296104a615ffdb951e694610cb6fc020eb",
            "filename": "src/test/java/org/springframework/data/jpa/repository/query/JpaQueryLookupStrategyUnitTests.java",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaQueryLookupStrategyUnitTests.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaQueryLookupStrategyUnitTests.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FJpaQueryLookupStrategyUnitTests.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -35,6 +35,7 @@\n import org.springframework.data.jpa.domain.sample.User;\n import org.springframework.data.jpa.provider.QueryExtractor;\n import org.springframework.data.jpa.repository.Query;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.data.projection.ProjectionFactory;\n import org.springframework.data.repository.Repository;\n import org.springframework.data.repository.core.NamedQueries;\n@@ -76,7 +77,7 @@ public void setUp() {\n \tpublic void invalidAnnotatedQueryCausesException() throws Exception {\n \n \t\tQueryLookupStrategy strategy = JpaQueryLookupStrategy.create(em, Key.CREATE_IF_NOT_FOUND, extractor,\n-\t\t\t\tEVALUATION_CONTEXT_PROVIDER);\n+\t\t\t\tEVALUATION_CONTEXT_PROVIDER, EscapeCharacter.of('\\\\'));\n \t\tMethod method = UserRepository.class.getMethod(\"findByFoo\", String.class);\n \t\tRepositoryMetadata metadata = new DefaultRepositoryMetadata(UserRepository.class);\n \n@@ -92,7 +93,7 @@ public void invalidAnnotatedQueryCausesException() throws Exception {\n \tpublic void sholdThrowMorePreciseExceptionIfTryingToUsePaginationInNativeQueries() throws Exception {\n \n \t\tQueryLookupStrategy strategy = JpaQueryLookupStrategy.create(em, Key.CREATE_IF_NOT_FOUND, extractor,\n-\t\t\t\tEVALUATION_CONTEXT_PROVIDER);\n+\t\t\t\tEVALUATION_CONTEXT_PROVIDER, EscapeCharacter.of('\\\\'));\n \t\tMethod method = UserRepository.class.getMethod(\"findByInvalidNativeQuery\", String.class, Sort.class);\n \t\tRepositoryMetadata metadata = new DefaultRepositoryMetadata(UserRepository.class);\n "
        },
        {
            "sha": "12d86f00e81753c74bb3e5b5c326b23ec76ba27c",
            "filename": "src/test/java/org/springframework/data/jpa/repository/query/ParameterExpressionProviderTests.java",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterExpressionProviderTests.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterExpressionProviderTests.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterExpressionProviderTests.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -29,6 +29,7 @@\n import org.junit.runner.RunWith;\n import org.springframework.data.jpa.domain.sample.User;\n import org.springframework.data.jpa.provider.PersistenceProvider;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.data.repository.query.DefaultParameters;\n import org.springframework.data.repository.query.Parameters;\n import org.springframework.data.repository.query.ParametersParameterAccessor;\n@@ -58,7 +59,7 @@ public void createsParameterExpressionWithMostConcreteType() throws Exception {\n \n \t\tCriteriaBuilder builder = em.getCriteriaBuilder();\n \t\tPersistenceProvider persistenceProvider = PersistenceProvider.fromEntityManager(em);\n-\t\tParameterMetadataProvider provider = new ParameterMetadataProvider(builder, accessor, persistenceProvider);\n+\t\tParameterMetadataProvider provider = new ParameterMetadataProvider(builder, accessor, persistenceProvider, EscapeCharacter.of('\\\\'));\n \t\tParameterExpression<? extends Comparable> expression = provider.next(part, Comparable.class).getExpression();\n \t\tassertThat(expression.getParameterType(), is(typeCompatibleWith(int.class)));\n \t}"
        },
        {
            "sha": "d3ffe80dbc0d82150224bcdc2e1d1999677a2367",
            "filename": "src/test/java/org/springframework/data/jpa/repository/query/ParameterMetadataProviderIntegrationTests.java",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterMetadataProviderIntegrationTests.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterMetadataProviderIntegrationTests.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterMetadataProviderIntegrationTests.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -15,7 +15,7 @@\n  */\n package org.springframework.data.jpa.repository.query;\n \n-import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.*;\n \n import java.lang.reflect.Method;\n import java.util.List;\n@@ -28,6 +28,7 @@\n import org.springframework.data.jpa.domain.sample.User;\n import org.springframework.data.jpa.provider.PersistenceProvider;\n import org.springframework.data.jpa.repository.query.ParameterMetadataProvider.ParameterMetadata;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.data.repository.query.Param;\n import org.springframework.data.repository.query.Parameters;\n import org.springframework.data.repository.query.parser.Part;\n@@ -81,7 +82,7 @@ private ParameterMetadataProvider createProvider(Method method) {\n \t\tsimulateDiscoveredParametername(parameters);\n \n \t\treturn new ParameterMetadataProvider(em.getCriteriaBuilder(), parameters,\n-\t\t\t\tPersistenceProvider.fromEntityManager(em));\n+\t\t\t\tPersistenceProvider.fromEntityManager(em), EscapeCharacter.of('\\\\'));\n \t}\n \n \t@SuppressWarnings({ \"unchecked\", \"ConstantConditions\" })"
        },
        {
            "sha": "4d79261d7d5e722d1121f8673e8f4a0b6b466ad8",
            "filename": "src/test/java/org/springframework/data/jpa/repository/query/ParameterMetadataProviderUnitTests.java",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterMetadataProviderUnitTests.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterMetadataProviderUnitTests.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FParameterMetadataProviderUnitTests.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -15,7 +15,7 @@\n  */\n package org.springframework.data.jpa.repository.query;\n \n-import static org.assertj.core.api.Assertions.assertThatExceptionOfType;\n+import static org.assertj.core.api.Assertions.*;\n import static org.mockito.Mockito.*;\n \n import java.util.Collections;\n@@ -24,6 +24,7 @@\n \n import org.junit.Test;\n import org.springframework.data.jpa.provider.PersistenceProvider;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.data.repository.query.Parameters;\n import org.springframework.data.repository.query.parser.Part;\n \n@@ -44,7 +45,7 @@ public void errorMessageMentionesParametersWhenParametersAreExhausted() {\n \t\twhen(parameters.getBindableParameters().iterator()).thenReturn(Collections.emptyListIterator());\n \n \t\tParameterMetadataProvider metadataProvider = new ParameterMetadataProvider(builder, parameters,\n-\t\t\t\tpersistenceProvider);\n+\t\t\t\tpersistenceProvider, EscapeCharacter.of('\\\\'));\n \n \t\tassertThatExceptionOfType(RuntimeException.class) //\n \t\t\t\t.isThrownBy(() -> metadataProvider.next(mock(Part.class))) //"
        },
        {
            "sha": "d745752596b1af29ce357a4cab60f230ce89fb86",
            "filename": "src/test/java/org/springframework/data/jpa/repository/query/PartTreeJpaQueryIntegrationTests.java",
            "status": "modified",
            "additions": 11,
            "deletions": 10,
            "changes": 21,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FPartTreeJpaQueryIntegrationTests.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FPartTreeJpaQueryIntegrationTests.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fquery%2FPartTreeJpaQueryIntegrationTests.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -44,6 +44,7 @@\n import org.springframework.data.jpa.provider.HibernateUtils;\n import org.springframework.data.jpa.provider.PersistenceProvider;\n import org.springframework.data.jpa.repository.Temporal;\n+import org.springframework.data.jpa.repository.support.EscapeCharacter;\n import org.springframework.data.projection.SpelAwareProxyProjectionFactory;\n import org.springframework.data.repository.Repository;\n import org.springframework.data.repository.core.support.DefaultRepositoryMetadata;\n@@ -81,7 +82,7 @@ public void setUp() {\n \tpublic void test() throws Exception {\n \n \t\tJpaQueryMethod queryMethod = getQueryMethod(\"findByFirstname\", String.class, Pageable.class);\n-\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider);\n+\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider, EscapeCharacter.of('\\\\'));\n \n \t\tjpaQuery.createQuery(new Object[] { \"Matthews\", PageRequest.of(0, 1) });\n \t\tjpaQuery.createQuery(new Object[] { \"Matthews\", PageRequest.of(0, 1) });\n@@ -105,7 +106,7 @@ public void cannotIgnoreCaseIfNotStringUnlessIgnoringAll() throws Exception {\n \tpublic void recreatesQueryIfNullValueIsGiven() throws Exception {\n \n \t\tJpaQueryMethod queryMethod = getQueryMethod(\"findByFirstname\", String.class, Pageable.class);\n-\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider);\n+\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider, EscapeCharacter.of('\\\\'));\n \n \t\tQuery query = jpaQuery.createQuery(new Object[] { \"Matthews\", PageRequest.of(0, 1) });\n \n@@ -120,7 +121,7 @@ public void recreatesQueryIfNullValueIsGiven() throws Exception {\n \tpublic void shouldLimitExistsProjectionQueries() throws Exception {\n \n \t\tJpaQueryMethod queryMethod = getQueryMethod(\"existsByFirstname\", String.class);\n-\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider);\n+\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider, EscapeCharacter.of('\\\\'));\n \n \t\tQuery query = jpaQuery.createQuery(new Object[] { \"Matthews\" });\n \n@@ -131,7 +132,7 @@ public void shouldLimitExistsProjectionQueries() throws Exception {\n \tpublic void shouldSelectAliasedIdForExistsProjectionQueries() throws Exception {\n \n \t\tJpaQueryMethod queryMethod = getQueryMethod(\"existsByFirstname\", String.class);\n-\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider);\n+\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider, EscapeCharacter.of('\\\\'));\n \n \t\tQuery query = jpaQuery.createQuery(new Object[] { \"Matthews\" });\n \n@@ -142,7 +143,7 @@ public void shouldSelectAliasedIdForExistsProjectionQueries() throws Exception {\n \tpublic void isEmptyCollection() throws Exception {\n \n \t\tJpaQueryMethod queryMethod = getQueryMethod(\"findByRolesIsEmpty\");\n-\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider);\n+\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider, EscapeCharacter.of('\\\\'));\n \n \t\tQuery query = jpaQuery.createQuery(new Object[] {});\n \n@@ -153,7 +154,7 @@ public void isEmptyCollection() throws Exception {\n \tpublic void isNotEmptyCollection() throws Exception {\n \n \t\tJpaQueryMethod queryMethod = getQueryMethod(\"findByRolesIsNotEmpty\");\n-\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider);\n+\t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager, provider, EscapeCharacter.of('\\\\'));\n \n \t\tQuery query = jpaQuery.createQuery(new Object[] {});\n \n@@ -164,7 +165,7 @@ public void isNotEmptyCollection() throws Exception {\n \tpublic void rejectsIsEmptyOnNonCollectionProperty() throws Exception {\n \n \t\tJpaQueryMethod method = getQueryMethod(\"findByFirstnameIsEmpty\");\n-\t\tAbstractJpaQuery jpaQuery = new PartTreeJpaQuery(method, entityManager, provider);\n+\t\tAbstractJpaQuery jpaQuery = new PartTreeJpaQuery(method, entityManager, provider, EscapeCharacter.of('\\\\'));\n \n \t\tjpaQuery.createQuery(new Object[] { \"Oliver\" });\n \t}\n@@ -175,7 +176,7 @@ public void errorsDueToMismatchOfParametersContainNameOfMethodAndInterface() thr\n \t\tJpaQueryMethod method = getQueryMethod(\"findByFirstname\");\n \n \t\tassertThatExceptionOfType(IllegalArgumentException.class) //\n-\t\t\t\t.isThrownBy(() -> new PartTreeJpaQuery(method, entityManager, provider)) //\n+\t\t\t\t.isThrownBy(() -> new PartTreeJpaQuery(method, entityManager, provider, EscapeCharacter.of('\\\\'))) //\n \t\t\t\t.withMessageContaining(\"findByFirstname\") // the method being analyzed\n \t\t\t\t.withMessageContaining(\" firstname \") // the property we are looking for\n \t\t\t\t.withMessageContaining(\"UserRepository\"); // the repository\n@@ -187,7 +188,7 @@ public void errorsDueToMissingPropertyContainNameOfMethodAndInterface() throws E\n \t\tJpaQueryMethod method = getQueryMethod(\"findByNoSuchProperty\", String.class);\n \n \t\tassertThatExceptionOfType(IllegalArgumentException.class) //\n-\t\t\t\t.isThrownBy(() -> new PartTreeJpaQuery(method, entityManager, provider)) //\n+\t\t\t\t.isThrownBy(() -> new PartTreeJpaQuery(method, entityManager, provider, EscapeCharacter.of('\\\\'))) //\n \t\t\t\t.withMessageContaining(\"findByNoSuchProperty\") // the method being analyzed\n \t\t\t\t.withMessageContaining(\" noSuchProperty \") // the property we are looking for\n \t\t\t\t.withMessageContaining(\"UserRepository\"); // the repository\n@@ -203,7 +204,7 @@ private void testIgnoreCase(String methodName, Object... values) throws Exceptio\n \n \t\tJpaQueryMethod queryMethod = getQueryMethod(methodName, parameterTypes);\n \t\tPartTreeJpaQuery jpaQuery = new PartTreeJpaQuery(queryMethod, entityManager,\n-\t\t\t\tPersistenceProvider.fromEntityManager(entityManager));\n+\t\t\t\tPersistenceProvider.fromEntityManager(entityManager), EscapeCharacter.of('\\\\'));\n \t\tjpaQuery.createQuery(values);\n \t}\n "
        },
        {
            "sha": "cce006b3d7e0e2ffd7cd163bcac8148b69d6da5c",
            "filename": "src/test/java/org/springframework/data/jpa/repository/sample/UserRepository.java",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/spring-projects/spring-data-jpa/blob/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsample%2FUserRepository.java",
            "raw_url": "https://github.com/spring-projects/spring-data-jpa/raw/4d4e6d418fe3bca14c7cff1c7161e3794026f960/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsample%2FUserRepository.java",
            "contents_url": "https://api.github.com/repos/spring-projects/spring-data-jpa/contents/src%2Ftest%2Fjava%2Forg%2Fspringframework%2Fdata%2Fjpa%2Frepository%2Fsample%2FUserRepository.java?ref=4d4e6d418fe3bca14c7cff1c7161e3794026f960",
            "patch": "@@ -556,6 +556,10 @@ List<User> findUsersByFirstnameForSpELExpressionWithParameterIndexOnlyWithEntity\n \t// DATAJPA-1334\n \tList<NameOnlyDto> findByNamedQueryWithConstructorExpression();\n \n+\t// DATAJPA-1519\n+\t@Query(\"select u from User u where u.firstname like %?#{#escape([0],'#')}% escape '#'\")\n+\tList<User> findContainingEscaped(String namePart);\n+\n \tinterface RolesAndFirstname {\n \n \t\tString getFirstname();"
        }
    ]
}