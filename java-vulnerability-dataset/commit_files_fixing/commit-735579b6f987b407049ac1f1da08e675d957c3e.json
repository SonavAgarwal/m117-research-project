{
    "sha": "735579b6f987b407049ac1f1da08e675d957c3e6",
    "node_id": "MDY6Q29tbWl0MjU2MjM5NDI6NzM1NTc5YjZmOTg3YjQwNzA0OWFjMWYxZGEwOGU2NzVkOTU3YzNlNg==",
    "commit": {
        "author": {
            "name": "Francesco Chicchiricc\u00f2",
            "email": "ilgrosso@apache.org",
            "date": "2018-03-07T11:21:21Z"
        },
        "committer": {
            "name": "Francesco Chicchiricc\u00f2",
            "email": "ilgrosso@apache.org",
            "date": "2018-03-09T13:56:22Z"
        },
        "message": "Review fields usable for search and orderBy",
        "tree": {
            "sha": "28ed3bff53f48ebeb470fd29db499edf1da59cbc",
            "url": "https://api.github.com/repos/apache/syncope/git/trees/28ed3bff53f48ebeb470fd29db499edf1da59cbc"
        },
        "url": "https://api.github.com/repos/apache/syncope/git/commits/735579b6f987b407049ac1f1da08e675d957c3e6",
        "comment_count": 0,
        "verification": {
            "verified": false,
            "reason": "unsigned",
            "signature": null,
            "payload": null,
            "verified_at": null
        }
    },
    "url": "https://api.github.com/repos/apache/syncope/commits/735579b6f987b407049ac1f1da08e675d957c3e6",
    "html_url": "https://github.com/apache/syncope/commit/735579b6f987b407049ac1f1da08e675d957c3e6",
    "comments_url": "https://api.github.com/repos/apache/syncope/commits/735579b6f987b407049ac1f1da08e675d957c3e6/comments",
    "author": {
        "login": "ilgrosso",
        "id": 1064664,
        "node_id": "MDQ6VXNlcjEwNjQ2NjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1064664?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ilgrosso",
        "html_url": "https://github.com/ilgrosso",
        "followers_url": "https://api.github.com/users/ilgrosso/followers",
        "following_url": "https://api.github.com/users/ilgrosso/following{/other_user}",
        "gists_url": "https://api.github.com/users/ilgrosso/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ilgrosso/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ilgrosso/subscriptions",
        "organizations_url": "https://api.github.com/users/ilgrosso/orgs",
        "repos_url": "https://api.github.com/users/ilgrosso/repos",
        "events_url": "https://api.github.com/users/ilgrosso/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ilgrosso/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "committer": {
        "login": "ilgrosso",
        "id": 1064664,
        "node_id": "MDQ6VXNlcjEwNjQ2NjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1064664?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ilgrosso",
        "html_url": "https://github.com/ilgrosso",
        "followers_url": "https://api.github.com/users/ilgrosso/followers",
        "following_url": "https://api.github.com/users/ilgrosso/following{/other_user}",
        "gists_url": "https://api.github.com/users/ilgrosso/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ilgrosso/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ilgrosso/subscriptions",
        "organizations_url": "https://api.github.com/users/ilgrosso/orgs",
        "repos_url": "https://api.github.com/users/ilgrosso/repos",
        "events_url": "https://api.github.com/users/ilgrosso/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ilgrosso/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "parents": [
        {
            "sha": "ad31479c1c543ac7d26b8c882aa14f6c00c1fd0a",
            "url": "https://api.github.com/repos/apache/syncope/commits/ad31479c1c543ac7d26b8c882aa14f6c00c1fd0a",
            "html_url": "https://github.com/apache/syncope/commit/ad31479c1c543ac7d26b8c882aa14f6c00c1fd0a"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 40,
        "deletions": 4
    },
    "files": [
        {
            "sha": "77a7d134cb86476ca0f9f932b443df43ebad5b29",
            "filename": "common/lib/src/main/java/org/apache/syncope/common/lib/search/SearchableFields.java",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/apache/syncope/blob/735579b6f987b407049ac1f1da08e675d957c3e6/common%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Fsearch%2FSearchableFields.java",
            "raw_url": "https://github.com/apache/syncope/raw/735579b6f987b407049ac1f1da08e675d957c3e6/common%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Fsearch%2FSearchableFields.java",
            "contents_url": "https://api.github.com/repos/apache/syncope/contents/common%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Fsearch%2FSearchableFields.java?ref=735579b6f987b407049ac1f1da08e675d957c3e6",
            "patch": "@@ -36,7 +36,7 @@\n public final class SearchableFields {\n \n     private static final String[] ATTRIBUTES_NOTINCLUDED = {\n-        \"serialVersionUID\", \"password\", \"type\", \"udynMembershipCond\"\n+        \"serialVersionUID\", \"password\", \"type\", \"udynMembershipCond\", \"securityAnswer\", \"token\", \"tokenExpireTime\"\n     };\n \n     private static final Set<String> ANY_FIELDS = new HashSet<>();"
        },
        {
            "sha": "229ecdf42943a6b6abf804e4801c269eaa6eb426",
            "filename": "core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/dao/AbstractAnySearchDAO.java",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/apache/syncope/blob/735579b6f987b407049ac1f1da08e675d957c3e6/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FAbstractAnySearchDAO.java",
            "raw_url": "https://github.com/apache/syncope/raw/735579b6f987b407049ac1f1da08e675d957c3e6/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FAbstractAnySearchDAO.java",
            "contents_url": "https://api.github.com/repos/apache/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FAbstractAnySearchDAO.java?ref=735579b6f987b407049ac1f1da08e675d957c3e6",
            "patch": "@@ -30,7 +30,10 @@\n import javax.validation.constraints.Max;\n import javax.validation.constraints.Min;\n import org.apache.commons.collections4.CollectionUtils;\n+import org.apache.commons.collections4.ListUtils;\n+import org.apache.commons.collections4.Predicate;\n import org.apache.commons.collections4.Transformer;\n+import org.apache.commons.lang3.ArrayUtils;\n import org.apache.commons.lang3.ClassUtils;\n import org.apache.commons.lang3.SerializationUtils;\n import org.apache.commons.lang3.tuple.Pair;\n@@ -68,6 +71,10 @@\n \n public abstract class AbstractAnySearchDAO extends AbstractDAO<Any<?>> implements AnySearchDAO {\n \n+    private static final String[] ORDER_BY_NOT_ALLOWED = {\n+        \"serialVersionUID\", \"password\", \"securityQuestion\", \"securityAnswer\", \"token\", \"tokenExpireTime\"\n+    };\n+\n     @Autowired\n     protected RealmDAO realmDAO;\n \n@@ -134,6 +141,16 @@ public <T extends Any<?>> List<T> search(\n         return search(SyncopeConstants.FULL_ADMIN_REALMS, cond, -1, -1, orderBy, kind);\n     }\n \n+    protected List<OrderByClause> filterOrderBy(final List<OrderByClause> orderBy) {\n+        return ListUtils.select(orderBy, new Predicate<OrderByClause>() {\n+\n+            @Override\n+            public boolean evaluate(final OrderByClause clause) {\n+                return !ArrayUtils.contains(ORDER_BY_NOT_ALLOWED, clause.getField());\n+            }\n+        });\n+    }\n+\n     protected abstract <T extends Any<?>> List<T> doSearch(\n             Set<String> adminRealms,\n             SearchCond searchCondition,"
        },
        {
            "sha": "f33295d17519c00e3fb791c62261d43d36253759",
            "filename": "core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/dao/JPAAnySearchDAO.java",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/apache/syncope/blob/735579b6f987b407049ac1f1da08e675d957c3e6/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAAnySearchDAO.java",
            "raw_url": "https://github.com/apache/syncope/raw/735579b6f987b407049ac1f1da08e675d957c3e6/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAAnySearchDAO.java",
            "contents_url": "https://api.github.com/repos/apache/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAAnySearchDAO.java?ref=735579b6f987b407049ac1f1da08e675d957c3e6",
            "patch": "@@ -276,13 +276,13 @@ private StringBuilder buildOrderBy(final OrderBySupport obs) {\n     }\n \n     private OrderBySupport parseOrderBy(\n-            final AnyTypeKind kind, final SearchSupport svs, final List<OrderByClause> orderByClauses) {\n+            final AnyTypeKind kind, final SearchSupport svs, final List<OrderByClause> orderBy) {\n \n         AnyUtils attrUtils = anyUtilsFactory.getInstance(kind);\n \n         OrderBySupport obs = new OrderBySupport();\n \n-        for (OrderByClause clause : orderByClauses) {\n+        for (OrderByClause clause : filterOrderBy(orderBy)) {\n             OrderBySupport.Item item = new OrderBySupport.Item();\n \n             // Manage difference among external key attribute and internal JPA @Id"
        },
        {
            "sha": "bb37c3deb9bdd24f5db1d3abefc566f42fa09ab8",
            "filename": "ext/elasticsearch/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/dao/ElasticsearchAnySearchDAO.java",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/apache/syncope/blob/735579b6f987b407049ac1f1da08e675d957c3e6/ext%2Felasticsearch%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FElasticsearchAnySearchDAO.java",
            "raw_url": "https://github.com/apache/syncope/raw/735579b6f987b407049ac1f1da08e675d957c3e6/ext%2Felasticsearch%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FElasticsearchAnySearchDAO.java",
            "contents_url": "https://api.github.com/repos/apache/syncope/contents/ext%2Felasticsearch%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FElasticsearchAnySearchDAO.java?ref=735579b6f987b407049ac1f1da08e675d957c3e6",
            "patch": "@@ -147,7 +147,7 @@ private void addSort(\n \n         AnyUtils attrUtils = anyUtilsFactory.getInstance(kind);\n \n-        for (OrderByClause clause : orderBy) {\n+        for (OrderByClause clause : filterOrderBy(orderBy)) {\n             String sortName = null;\n \n             // Manage difference among external key attribute and internal JPA @Id"
        },
        {
            "sha": "4af22aa63683718de1c0f43f2832d6b8cf6707e3",
            "filename": "fit/core-reference/src/test/java/org/apache/syncope/fit/core/SearchITCase.java",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/apache/syncope/blob/735579b6f987b407049ac1f1da08e675d957c3e6/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FSearchITCase.java",
            "raw_url": "https://github.com/apache/syncope/raw/735579b6f987b407049ac1f1da08e675d957c3e6/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FSearchITCase.java",
            "contents_url": "https://api.github.com/repos/apache/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FSearchITCase.java?ref=735579b6f987b407049ac1f1da08e675d957c3e6",
            "patch": "@@ -29,6 +29,7 @@\n import org.apache.commons.collections4.CollectionUtils;\n import org.apache.commons.collections4.IterableUtils;\n import org.apache.commons.collections4.Predicate;\n+import org.apache.commons.lang3.RandomStringUtils;\n import org.apache.syncope.client.lib.SyncopeClient;\n import org.apache.syncope.common.lib.SyncopeConstants;\n import org.apache.syncope.common.lib.patch.AnyObjectPatch;\n@@ -406,6 +407,24 @@ public boolean evaluate(final UserTO user) {\n         }));\n     }\n \n+    @Test\n+    public void searchBySecurityAnswer() {\n+        String securityAnswer = RandomStringUtils.randomAlphanumeric(10);\n+        UserTO userTO = UserITCase.getUniqueSampleTO(\"securityAnswer@syncope.apache.org\");\n+        userTO.setSecurityQuestion(\"887028ea-66fc-41e7-b397-620d7ea6dfbb\");\n+        userTO.setSecurityAnswer(securityAnswer);\n+\n+        userTO = createUser(userTO).getEntity();\n+        assertNotNull(userTO.getSecurityQuestion());\n+\n+        PagedResult<UserTO> matchingUsers = userService.search(\n+                new AnyQuery.Builder().realm(SyncopeConstants.ROOT_REALM).\n+                        fiql(SyncopeClient.getUserSearchConditionBuilder().\n+                                is(\"securityAnswer\").equalTo(securityAnswer).query()).build());\n+        assertNotNull(matchingUsers);\n+        assertTrue(matchingUsers.getResult().isEmpty());\n+    }\n+\n     @Test\n     public void assignable() {\n         PagedResult<GroupTO> groups = groupService.search(new AnyQuery.Builder().realm(\"/even/two\").page(1).size(1000)."
        }
    ]
}