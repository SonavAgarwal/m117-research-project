{
    "sha": "49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
    "node_id": "MDY6Q29tbWl0NTAyMjk0ODc6NDlhM2YwYTExZDQxZjcxMjRiODkzYTA4ZGM5ZTY3NTk0YzMyZTJlZQ==",
    "commit": {
        "author": {
            "name": "Jan H\u00f8ydahl",
            "email": "janhoy@users.noreply.github.com",
            "date": "2020-06-29T11:18:24Z"
        },
        "committer": {
            "name": "GitHub",
            "email": "noreply@github.com",
            "date": "2020-06-29T11:18:24Z"
        },
        "message": "SOLR-14561 Followup - validate params for more core operations  (#1629)\n\nAdd template to solr.in scripts\r\nAlso testes Windows paths\r\nAdded RefGuide documentation to some params",
        "tree": {
            "sha": "fc20e30d813c83032b9a5ff704b65040a410c157",
            "url": "https://api.github.com/repos/apache/lucene-solr/git/trees/fc20e30d813c83032b9a5ff704b65040a410c157"
        },
        "url": "https://api.github.com/repos/apache/lucene-solr/git/commits/49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
        "comment_count": 0,
        "verification": {
            "verified": true,
            "reason": "valid",
            "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe+c4ACRBK7hj4Ov3rIwAAdHIIAEjbCODgUH36RWzl953Knf+l\nDyzHDgYgoyP9sFN8FBXyR91p1A9jZlzJ4ZBGdIi9J+EbWO+wCCB4lt6YQqEfQQgL\nKukUpJBBREOzt4/Z3B9MIvT0sAslAV2URzRrHR8EPuQ5vm039HfYnEFcCUq6GNdt\nC+QnjuIWsf8SgAEgD7DUAXGDxZKbHKJ3L0ymr/qpCK3XeVNFlAARbHF90sCQs599\nnsYGuHMniHg4BbiIcnIsnjR8rXuV/rDsgIEXevglCUIGeRwl6oR8O13pYCrlS7j1\n1VB5y4+Elqk1IOy9WT/No0iTKOWaFlm4p4hNb0ZBonsuoCC5Xs0goVIJTl6gsDQ=\n=CY1J\n-----END PGP SIGNATURE-----\n",
            "payload": "tree fc20e30d813c83032b9a5ff704b65040a410c157\nparent 574e399ce58fc5b23e69e52be28a97b6fc587616\nauthor Jan H\u00f8ydahl <janhoy@users.noreply.github.com> 1593429504 +0200\ncommitter GitHub <noreply@github.com> 1593429504 +0200\n\nSOLR-14561 Followup - validate params for more core operations  (#1629)\n\nAdd template to solr.in scripts\r\nAlso testes Windows paths\r\nAdded RefGuide documentation to some params",
            "verified_at": "2024-01-16T19:59:59Z"
        }
    },
    "url": "https://api.github.com/repos/apache/lucene-solr/commits/49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
    "html_url": "https://github.com/apache/lucene-solr/commit/49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
    "comments_url": "https://api.github.com/repos/apache/lucene-solr/commits/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/comments",
    "author": {
        "login": "janhoy",
        "id": 409128,
        "node_id": "MDQ6VXNlcjQwOTEyOA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/409128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janhoy",
        "html_url": "https://github.com/janhoy",
        "followers_url": "https://api.github.com/users/janhoy/followers",
        "following_url": "https://api.github.com/users/janhoy/following{/other_user}",
        "gists_url": "https://api.github.com/users/janhoy/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/janhoy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/janhoy/subscriptions",
        "organizations_url": "https://api.github.com/users/janhoy/orgs",
        "repos_url": "https://api.github.com/users/janhoy/repos",
        "events_url": "https://api.github.com/users/janhoy/events{/privacy}",
        "received_events_url": "https://api.github.com/users/janhoy/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "committer": {
        "login": "web-flow",
        "id": 19864447,
        "node_id": "MDQ6VXNlcjE5ODY0NDQ3",
        "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/web-flow",
        "html_url": "https://github.com/web-flow",
        "followers_url": "https://api.github.com/users/web-flow/followers",
        "following_url": "https://api.github.com/users/web-flow/following{/other_user}",
        "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions",
        "organizations_url": "https://api.github.com/users/web-flow/orgs",
        "repos_url": "https://api.github.com/users/web-flow/repos",
        "events_url": "https://api.github.com/users/web-flow/events{/privacy}",
        "received_events_url": "https://api.github.com/users/web-flow/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "parents": [
        {
            "sha": "574e399ce58fc5b23e69e52be28a97b6fc587616",
            "url": "https://api.github.com/repos/apache/lucene-solr/commits/574e399ce58fc5b23e69e52be28a97b6fc587616",
            "html_url": "https://github.com/apache/lucene-solr/commit/574e399ce58fc5b23e69e52be28a97b6fc587616"
        }
    ],
    "stats": {
        "total": 144,
        "additions": 102,
        "deletions": 42
    },
    "files": [
        {
            "sha": "0178c67b1fcc17ec88035ebfb958a24935565fe5",
            "filename": "solr/core/src/java/org/apache/solr/core/SolrPaths.java",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fcore%2FSolrPaths.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fcore%2FSolrPaths.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fcore%2FSolrPaths.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -117,6 +117,7 @@ private static void logOnceInfo(String key, String msg) {\n    * @throws SolrException if path is outside allowed paths\n    */\n   public static void assertPathAllowed(Path pathToAssert, Set<Path> allowPaths) throws SolrException {\n+    if (pathToAssert == null) return;\n     if (OS.isFamilyWindows() && pathToAssert.toString().startsWith(\"\\\\\\\\\")) {\n       throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,\n           \"Path \" + pathToAssert + \" disallowed. UNC paths not supported. Please use drive letter instead.\");"
        },
        {
            "sha": "67230144bdc5d779cdf672dfad4a529558012167",
            "filename": "solr/core/src/java/org/apache/solr/handler/ReplicationHandler.java",
            "status": "modified",
            "additions": 15,
            "deletions": 8,
            "changes": 23,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fhandler%2FReplicationHandler.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fhandler%2FReplicationHandler.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fhandler%2FReplicationHandler.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -324,10 +324,13 @@ public boolean abortFetch() {\n     }\n   }\n \n+  @SuppressWarnings(\"deprecation\")\n   private void deleteSnapshot(ModifiableSolrParams params, SolrQueryResponse rsp) {\n-    String name = params.required().get(NAME);\n+    params.required().get(NAME);\n \n-    SnapShooter snapShooter = new SnapShooter(core, params.get(CoreAdminParams.BACKUP_LOCATION), params.get(NAME));\n+    String location = params.get(CoreAdminParams.BACKUP_LOCATION);\n+    core.getCoreContainer().assertPathAllowed(location == null ? null : Path.of(location));\n+    SnapShooter snapShooter = new SnapShooter(core, location, params.get(NAME));\n     snapShooter.validateDeleteSnapshot();\n     snapShooter.deleteSnapAsync(this);\n     rsp.add(STATUS, OK_STATUS);\n@@ -448,7 +451,6 @@ private void restore(SolrParams params, SolrQueryResponse rsp, SolrQueryRequest\n     }\n     String name = params.get(NAME);\n     String location = params.get(CoreAdminParams.BACKUP_LOCATION);\n-\n     String repoName = params.get(CoreAdminParams.BACKUP_REPOSITORY);\n     CoreContainer cc = core.getCoreContainer();\n     BackupRepository repo = null;\n@@ -460,11 +462,13 @@ private void restore(SolrParams params, SolrQueryResponse rsp, SolrQueryRequest\n       }\n     } else {\n       repo = new LocalFileSystemRepository();\n+      //If location is not provided then assume that the restore index is present inside the data directory.\n+      if (location == null) {\n+        location = core.getDataDir();\n+      }\n     }\n-\n-    //If location is not provided then assume that the restore index is present inside the data directory.\n-    if (location == null) {\n-      location = core.getDataDir();\n+    if (\"file\".equals(repo.createURI(\"x\").getScheme())) {\n+      core.getCoreContainer().assertPathAllowed(Paths.get(location));\n     }\n \n     URI locationUri = repo.createURI(location);\n@@ -573,8 +577,11 @@ private void doSnapShoot(SolrParams params, SolrQueryResponse rsp, SolrQueryRequ\n           location = core.getCoreDescriptor().getInstanceDir().resolve(location).normalize().toString();\n         }\n       }\n+      if (\"file\".equals(repo.createURI(\"x\").getScheme())) {\n+        core.getCoreContainer().assertPathAllowed(Paths.get(location));\n+      }\n \n-      // small race here before the commit point is saved\n+        // small race here before the commit point is saved\n       URI locationUri = repo.createURI(location);\n       String commitName = params.get(CoreAdminParams.COMMIT_NAME);\n       SnapShooter snapShooter = new SnapShooter(repo, core, locationUri, params.get(NAME), commitName);"
        },
        {
            "sha": "10c0c8a3d8c58f10ce78d5542e27ff9d162c2d5d",
            "filename": "solr/core/src/java/org/apache/solr/handler/SnapShooter.java",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fhandler%2FSnapShooter.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fhandler%2FSnapShooter.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fhandler%2FSnapShooter.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -86,6 +86,9 @@ private void initialize(BackupRepository backupRepo, SolrCore core, URI location\n     this.backupRepo = Objects.requireNonNull(backupRepo);\n     this.baseSnapDirPath = location;\n     this.snapshotName = snapshotName;\n+    if (\"file\".equals(location.getScheme())) {\n+      solrCore.getCoreContainer().assertPathAllowed(Paths.get(location));\n+    }\n     if (snapshotName != null) {\n       directoryName = \"snapshot.\" + snapshotName;\n     } else {"
        },
        {
            "sha": "d9f5de3b76f110ee05a6d58694a4ddfd4e6a9433",
            "filename": "solr/core/src/java/org/apache/solr/handler/admin/MergeIndexesOp.java",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fhandler%2Fadmin%2FMergeIndexesOp.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fhandler%2Fadmin%2FMergeIndexesOp.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fhandler%2Fadmin%2FMergeIndexesOp.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -18,10 +18,8 @@\n package org.apache.solr.handler.admin;\n \n import java.lang.invoke.MethodHandles;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Set;\n+import java.nio.file.Paths;\n+import java.util.*;\n \n import com.google.common.collect.Lists;\n import org.apache.lucene.index.DirectoryReader;\n@@ -79,6 +77,8 @@ public void execute(CoreAdminHandler.CallInfo it) throws Exception {\n           sourceCores.add(srcCore);\n         }\n       } else {\n+        // Validate each 'indexDir' input as valid\n+        Arrays.stream(dirNames).forEach(indexDir -> core.getCoreContainer().assertPathAllowed(Paths.get(indexDir)));\n         DirectoryFactory dirFactory = core.getDirectoryFactory();\n         for (int i = 0; i < dirNames.length; i++) {\n           boolean markAsDone = false;"
        },
        {
            "sha": "c3a30d8e47f9d67f430b069fb69c1f51298c196b",
            "filename": "solr/core/src/test/org/apache/solr/cloud/BasicDistributedZk2Test.java",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcloud%2FBasicDistributedZk2Test.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcloud%2FBasicDistributedZk2Test.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcloud%2FBasicDistributedZk2Test.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -404,8 +404,9 @@ private void brindDownShardIndexSomeDocsAndRecover() throws Exception {\n       params.set(\"qt\", ReplicationHandler.PATH);\n       params.set(\"command\", \"backup\");\n       params.set(\"name\", backupName);\n-      Path location = createTempDir();\n-      location = FilterPath.unwrap(location).toRealPath();\n+      final Path location = FilterPath.unwrap(createTempDir()).toRealPath();\n+      // Allow non-standard location outside SOLR_HOME\n+      jettys.forEach(j -> j.getCoreContainer().getAllowPaths().add(location));\n       params.set(\"location\", location.toString());\n \n       QueryRequest request = new QueryRequest(params);"
        },
        {
            "sha": "1b813515ead579e980d697ac7087874e260f6c63",
            "filename": "solr/core/src/test/org/apache/solr/cloud/api/collections/AbstractCloudBackupRestoreTestCase.java",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcloud%2Fapi%2Fcollections%2FAbstractCloudBackupRestoreTestCase.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcloud%2Fapi%2Fcollections%2FAbstractCloudBackupRestoreTestCase.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcloud%2Fapi%2Fcollections%2FAbstractCloudBackupRestoreTestCase.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -47,6 +47,7 @@\n import org.apache.solr.common.cloud.Slice;\n import org.apache.solr.common.params.CollectionAdminParams;\n import org.apache.solr.common.params.CoreAdminParams;\n+import org.junit.AfterClass;\n import org.junit.BeforeClass;\n import org.junit.Test;\n import org.slf4j.Logger;\n@@ -72,6 +73,12 @@ public abstract class AbstractCloudBackupRestoreTestCase extends SolrCloudTestCa\n   @BeforeClass\n   public static void createCluster() throws Exception {\n     docsSeed = random().nextLong();\n+    System.setProperty(\"solr.allowPaths\", \"*\");\n+  }\n+\n+  @AfterClass\n+  public static void afterClass() throws Exception {\n+    System.clearProperty(\"solr.allowPaths\");\n   }\n \n   /**"
        },
        {
            "sha": "2a6d05dec9f5ab102125ca7d64bb25e175898166",
            "filename": "solr/core/src/test/org/apache/solr/core/snapshots/TestSolrCloudSnapshots.java",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcore%2Fsnapshots%2FTestSolrCloudSnapshots.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcore%2Fsnapshots%2FTestSolrCloudSnapshots.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcore%2Fsnapshots%2FTestSolrCloudSnapshots.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -65,6 +65,7 @@ public class TestSolrCloudSnapshots extends SolrCloudTestCase {\n   @BeforeClass\n   public static void setupClass() throws Exception {\n     useFactory(\"solr.StandardDirectoryFactory\");\n+    System.setProperty(\"solr.allowPaths\", \"*\");\n     configureCluster(NUM_NODES)// nodes\n         .addConfig(\"conf1\", TEST_PATH().resolve(\"configsets\").resolve(\"cloud-minimal\").resolve(\"conf\"))\n         .configure();\n@@ -76,6 +77,7 @@ public static void setupClass() throws Exception {\n   public static void teardownClass() throws Exception {\n     System.clearProperty(\"test.build.data\");\n     System.clearProperty(\"test.cache.data\");\n+    System.clearProperty(\"solr.allowPaths\");\n   }\n \n   @Test"
        },
        {
            "sha": "23fed680837acfd6f726deb4a1d50d85c936f1a8",
            "filename": "solr/core/src/test/org/apache/solr/core/snapshots/TestSolrCoreSnapshots.java",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcore%2Fsnapshots%2FTestSolrCoreSnapshots.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcore%2Fsnapshots%2FTestSolrCoreSnapshots.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fcore%2Fsnapshots%2FTestSolrCoreSnapshots.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -66,6 +66,7 @@ public class TestSolrCoreSnapshots extends SolrCloudTestCase {\n \n   @BeforeClass\n   public static void setupClass() throws Exception {\n+    System.setProperty(\"solr.allowPaths\", \"*\");\n     useFactory(\"solr.StandardDirectoryFactory\");\n     configureCluster(1)// nodes\n         .addConfig(\"conf1\", TEST_PATH().resolve(\"configsets\").resolve(\"cloud-minimal\").resolve(\"conf\"))\n@@ -77,6 +78,7 @@ public static void setupClass() throws Exception {\n   public static void teardownClass() throws Exception {\n     System.clearProperty(\"test.build.data\");\n     System.clearProperty(\"test.cache.data\");\n+    System.clearProperty(\"solr.allowPaths\");\n   }\n \n   @Test"
        },
        {
            "sha": "858b8072e033350a31f938d723d5c00429001cc2",
            "filename": "solr/core/src/test/org/apache/solr/handler/TestCoreBackup.java",
            "status": "modified",
            "additions": 12,
            "deletions": 10,
            "changes": 22,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FTestCoreBackup.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FTestCoreBackup.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FTestCoreBackup.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -16,16 +16,11 @@\n  */\n package org.apache.solr.handler;\n \n-import java.io.File;\n-import java.io.IOException;\n-import java.util.Arrays;\n-\n-import org.apache.lucene.index.IndexCommit;\n import org.apache.lucene.index.DirectoryReader;\n+import org.apache.lucene.index.IndexCommit;\n import org.apache.lucene.store.Directory;\n import org.apache.lucene.store.FSDirectory;\n import org.apache.lucene.util.TestUtil;\n-\n import org.apache.solr.SolrTestCaseJ4;\n import org.apache.solr.common.params.CoreAdminParams;\n import org.apache.solr.core.CoreContainer;\n@@ -34,8 +29,12 @@\n import org.junit.After;\n import org.junit.Before;\n \n-public class TestCoreBackup extends SolrTestCaseJ4 {\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Paths;\n+import java.util.Arrays;\n \n+public class TestCoreBackup extends SolrTestCaseJ4 {\n   @Before // unique core per test\n   public void coreInit() throws Exception {\n     initCore(\"solrconfig.xml\", \"schema.xml\");\n@@ -63,6 +62,7 @@ public void testBackupWithDocsNotSearchable() throws Exception {\n     String snapshotName = TestUtil.randomSimpleString(random(), 1, 5);\n \n     final CoreContainer cores = h.getCoreContainer();\n+    cores.getAllowPaths().add(Paths.get(location));\n     try (final CoreAdminHandler admin = new CoreAdminHandler(cores)) {\n       SolrQueryResponse resp = new SolrQueryResponse();\n       admin.handleRequestBody\n@@ -96,7 +96,8 @@ public void testBackupBeforeFirstCommit() throws Exception {\n     final CoreAdminHandler admin = new CoreAdminHandler(cores);\n \n     final File backupDir = createTempDir().toFile();\n-    \n+    cores.getAllowPaths().add(backupDir.toPath());\n+\n     { // first a backup before we've ever done *anything*...\n       SolrQueryResponse resp = new SolrQueryResponse();\n       admin.handleRequestBody\n@@ -197,8 +198,9 @@ public void testBackupAfterSoftCommit() throws Exception {\n     final CoreAdminHandler admin = new CoreAdminHandler(cores);\n     \n     final File backupDir = createTempDir().toFile();\n-    \n-    \n+    cores.getAllowPaths().add(backupDir.toPath());\n+\n+\n     { // take an initial 'backup1a' containing our 1 document\n       final SolrQueryResponse resp = new SolrQueryResponse();\n       admin.handleRequestBody"
        },
        {
            "sha": "a194bcf4a1fda920fccc01f80227b2bf2796a62f",
            "filename": "solr/core/src/test/org/apache/solr/handler/TestReplicationHandler.java",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FTestReplicationHandler.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FTestReplicationHandler.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FTestReplicationHandler.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -1618,7 +1618,9 @@ public void testShouldReportErrorWhenDeletingBackupButNameMissing() {\n   public void testEmptyBackups() throws Exception {\n     final File backupDir = createTempDir().toFile();\n     final BackupStatusChecker backupStatus = new BackupStatusChecker(masterClient);\n-    \n+\n+    masterJetty.getCoreContainer().getAllowPaths().add(backupDir.toPath());\n+\n     { // initial request w/o any committed docs\n       final String backupName = \"empty_backup1\";\n       final GenericSolrRequest req = new GenericSolrRequest"
        },
        {
            "sha": "6b60b199ae7524c0a3931518ed0a4e210491d812",
            "filename": "solr/core/src/test/org/apache/solr/handler/TestRestoreCore.java",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FTestRestoreCore.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FTestRestoreCore.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FTestRestoreCore.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -125,6 +125,7 @@ public void testSimpleRestore() throws Exception {\n     //Use the default backup location or an externally provided location.\n     if (random().nextBoolean()) {\n       location = createTempDir().toFile().getAbsolutePath();\n+      masterJetty.getCoreContainer().getAllowPaths().add(Path.of(location)); // Allow core to be created outside SOLR_HOME\n       params += \"&location=\" + URLEncoder.encode(location, \"UTF-8\");\n     }\n \n@@ -181,11 +182,21 @@ public void testSimpleRestore() throws Exception {\n \n   }\n \n+  public void testBackupFailsMissingAllowPaths() throws Exception {\n+    final String params = \"&location=\" + URLEncoder.encode(createTempDir().toFile().getAbsolutePath(), \"UTF-8\");\n+    Throwable t = expectThrows(IOException.class, () -> {\n+      TestReplicationHandlerBackup.runBackupCommand(masterJetty, ReplicationHandler.CMD_BACKUP, params);\n+    });\n+    // The backup command will fail since the tmp dir is outside allowPaths\n+    assertTrue(t.getMessage().contains(\"Server returned HTTP response code: 400\"));\n+  }\n+\n   @Test\n   public void testFailedRestore() throws Exception {\n     int nDocs = BackupRestoreUtils.indexDocs(masterClient, \"collection1\", docsSeed);\n \n     String location = createTempDir().toFile().getAbsolutePath();\n+    masterJetty.getCoreContainer().getAllowPaths().add(Path.of(location));\n     String snapshotName = TestUtil.randomSimpleString(random(), 1, 5);\n     String params = \"&name=\" + snapshotName + \"&location=\" + URLEncoder.encode(location, \"UTF-8\");\n     String baseUrl = masterJetty.getBaseUrl().toString();"
        },
        {
            "sha": "8e570e4645e69bc0d990d52b09c011b64f3d5776",
            "filename": "solr/core/src/test/org/apache/solr/handler/V2ApiIntegrationTest.java",
            "status": "modified",
            "additions": 8,
            "deletions": 11,
            "changes": 19,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FV2ApiIntegrationTest.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FV2ApiIntegrationTest.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2FV2ApiIntegrationTest.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -17,20 +17,10 @@\n \n package org.apache.solr.handler;\n \n-\n-import java.io.IOException;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Map;\n-\n import org.apache.solr.client.solrj.ResponseParser;\n import org.apache.solr.client.solrj.SolrRequest;\n import org.apache.solr.client.solrj.SolrServerException;\n-import org.apache.solr.client.solrj.impl.BaseHttpSolrClient;\n-import org.apache.solr.client.solrj.impl.BinaryResponseParser;\n-import org.apache.solr.client.solrj.impl.CloudSolrClient;\n-import org.apache.solr.client.solrj.impl.NoOpResponseParser;\n-import org.apache.solr.client.solrj.impl.XMLResponseParser;\n+import org.apache.solr.client.solrj.impl.*;\n import org.apache.solr.client.solrj.request.CollectionAdminRequest;\n import org.apache.solr.client.solrj.request.V2Request;\n import org.apache.solr.client.solrj.response.DelegationTokenResponse;\n@@ -42,6 +32,12 @@\n import org.junit.BeforeClass;\n import org.junit.Test;\n \n+import java.io.IOException;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n public class V2ApiIntegrationTest extends SolrCloudTestCase {\n   private static String COLL_NAME = \"collection1\";\n \n@@ -176,6 +172,7 @@ public void testCollectionsApi() throws Exception {\n     backupParams.put(\"name\", \"backup_test\");\n     backupParams.put(\"collection\", COLL_NAME);\n     backupParams.put(\"location\", tempDir);\n+    cluster.getJettySolrRunners().forEach(j -> j.getCoreContainer().getAllowPaths().add(Paths.get(tempDir)));\n     client.request(new V2Request.Builder(\"/c\")\n         .withMethod(SolrRequest.METHOD.POST)\n         .withPayload(Utils.toJSONString(backupPayload))"
        },
        {
            "sha": "9ceaa8a57d439d79a27862616edc62326c47ae19",
            "filename": "solr/core/src/test/org/apache/solr/handler/admin/CoreMergeIndexesAdminHandlerTest.java",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2Fadmin%2FCoreMergeIndexesAdminHandlerTest.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2Fadmin%2FCoreMergeIndexesAdminHandlerTest.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fcore%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fhandler%2Fadmin%2FCoreMergeIndexesAdminHandlerTest.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -16,9 +16,7 @@\n  */\n package org.apache.solr.handler.admin;\n \n-import java.io.File;\n-import java.io.IOException;\n-\n+import com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule;\n import org.apache.lucene.store.Directory;\n import org.apache.lucene.store.LockFactory;\n import org.apache.solr.SolrTestCaseJ4;\n@@ -35,7 +33,8 @@\n import org.junit.rules.RuleChain;\n import org.junit.rules.TestRule;\n \n-import com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule;\n+import java.io.File;\n+import java.io.IOException;\n \n public class CoreMergeIndexesAdminHandlerTest extends SolrTestCaseJ4 {\n   \n@@ -74,6 +73,7 @@ public void testMergeIndexesCoreAdminHandler() throws Exception {\n     final File workDir = createTempDir().toFile();\n \n     final CoreContainer cores = h.getCoreContainer();\n+    cores.getAllowPaths().add(workDir.toPath());\n \n     try (final CoreAdminHandler admin = new CoreAdminHandler(cores);\n          SolrCore core = cores.getCore(\"collection1\")) {"
        },
        {
            "sha": "ce7d66e03da0c8142bb23a6edf0b011d7ea1c823",
            "filename": "solr/solr-ref-guide/src/index-replication.adoc",
            "status": "modified",
            "additions": 24,
            "deletions": 1,
            "changes": 25,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fsolr-ref-guide%2Fsrc%2Findex-replication.adoc",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fsolr-ref-guide%2Fsrc%2Findex-replication.adoc",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fsolr-ref-guide%2Fsrc%2Findex-replication.adoc?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -328,7 +328,30 @@ This command is useful for making periodic backups. There are several supported\n +\n * `numberToKeep:`: This can be used with the backup command unless the `maxNumberOfBackups` initialization parameter has been specified on the handler \u2013 in which case `maxNumberOfBackups` is always used and attempts to use the `numberToKeep` request parameter will cause an error.\n * `name`: (optional) Backup name. The snapshot will be created in a directory called `snapshot.<name>` within the data directory of the core. By default the name is generated using date in `yyyyMMddHHmmssSSS` format. If `location` parameter is passed, that would be used instead of the data directory\n-* `location`: Backup location.\n+* `repository`: The name of the backup repository to use. When not specified, it defaults to local file system.\n+* `location`: Backup location. Value depends on the repository in use. For file system repository, location defaults to core's dataDir, and if specified, it needs to be within `SOLR_HOME`, `SOLR_DATA_HOME` or the paths specified by solr.xml `allowPaths`.\n+\n+`restore`::\n+Restore a backup from a backup repository.\n++\n+[source,bash]\n+http://_master_host:port_/solr/_core_name_/replication?command=restore\n++\n+This command is used to restore a backup. There are several supported request parameters:\n++\n+* `name`: (optional) Backup name. The name of the backed up index snapshot to be restored. If the name is not provided, it looks for backups with snapshot.<timestamp> format in the location directory. It picks the latest timestamp backup in that case.\n+* `repository`: The name of the backup repository where the backup resides. When not specified, it defaults to local file system.\n+* `location`: Backup location. Value depends on the repository in use. For file system repository, location defaults to core's dataDir, and if specified, it needs to be within `SOLR_HOME`, `SOLR_DATA_HOME` or the paths specified by solr.xml `allowPaths`.\n+\n+`restorestatus`::\n+Check the status of a running restore operation.\n++\n+[source,bash]\n+http://_master_host:port_/solr/_core_name_/replication?command=restorestatus\n++\n+This command is used to check the status of a restore operation. This command takes no parameters.\n++\n+The status value can be \"In Progress\" , \"success\" or \"failed\". If it failed then an \"exception\" will also be sent in the response.\n \n `deletebackup`::\n Delete any backup created using the `backup` command."
        },
        {
            "sha": "23a70ce1bf4bf1e8319c6560f3b2823648362898",
            "filename": "solr/solrj/src/test/org/apache/solr/client/solrj/MergeIndexesExampleTestBase.java",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fsolrj%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fclient%2Fsolrj%2FMergeIndexesExampleTestBase.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Fsolrj%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fclient%2Fsolrj%2FMergeIndexesExampleTestBase.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Fsolrj%2Fsrc%2Ftest%2Forg%2Fapache%2Fsolr%2Fclient%2Fsolrj%2FMergeIndexesExampleTestBase.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -77,7 +77,8 @@ public void setUp() throws Exception {\n     if (log.isInfoEnabled()) {\n       log.info(\"CORES={} : {}\", cores, cores.getLoadedCoreNames());\n     }\n-\n+    cores.getAllowPaths().add(dataDir1.toPath());\n+    cores.getAllowPaths().add(dataDir2.toPath());\n   }\n \n   @Override"
        },
        {
            "sha": "70a51a90e4f8178eb6479b783692994e7ab0342c",
            "filename": "solr/test-framework/src/java/org/apache/solr/cloud/MiniSolrCloudCluster.java",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/apache/lucene-solr/blob/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Ftest-framework%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fcloud%2FMiniSolrCloudCluster.java",
            "raw_url": "https://github.com/apache/lucene-solr/raw/49a3f0a11d41f7124b893a08dc9e67594c32e2ee/solr%2Ftest-framework%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fcloud%2FMiniSolrCloudCluster.java",
            "contents_url": "https://api.github.com/repos/apache/lucene-solr/contents/solr%2Ftest-framework%2Fsrc%2Fjava%2Forg%2Fapache%2Fsolr%2Fcloud%2FMiniSolrCloudCluster.java?ref=49a3f0a11d41f7124b893a08dc9e67594c32e2ee",
            "patch": "@@ -91,6 +91,7 @@ public class MiniSolrCloudCluster {\n   public static final String DEFAULT_CLOUD_SOLR_XML = \"<solr>\\n\" +\n       \"\\n\" +\n       \"  <str name=\\\"shareSchema\\\">${shareSchema:false}</str>\\n\" +\n+      \"  <str name=\\\"allowPaths\\\">${solr.allowPaths:}</str>\\n\" +\n       \"  <str name=\\\"configSetBaseDir\\\">${configSetBaseDir:configsets}</str>\\n\" +\n       \"  <str name=\\\"coreRootDirectory\\\">${coreRootDirectory:.}</str>\\n\" +\n       \"  <str name=\\\"collectionsHandler\\\">${collectionsHandler:solr.CollectionsHandler}</str>\\n\" +"
        }
    ]
}