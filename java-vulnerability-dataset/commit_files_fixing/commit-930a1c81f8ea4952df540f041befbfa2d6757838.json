{
    "sha": "930a1c81f8ea4952df540f041befbfa2d6757838",
    "node_id": "MDY6Q29tbWl0NTc5NTEwMTI6OTMwYTFjODFmOGVhNDk1MmRmNTQwZjA0MWJlZmJmYTJkNjc1NzgzOA==",
    "commit": {
        "author": {
            "name": "Alexey Subach",
            "email": "alexey.subach@duallab.com",
            "date": "2017-05-24T09:18:43Z"
        },
        "committer": {
            "name": "Alexey Subach",
            "email": "alexey.subach@duallab.com",
            "date": "2017-05-24T09:18:43Z"
        },
        "message": "Prevent XXE vulnerability\n\nDEVSIX-1273",
        "tree": {
            "sha": "d44b815fdcdd8f0286e38a293a793729e846b62b",
            "url": "https://api.github.com/repos/itext/itext-java/git/trees/d44b815fdcdd8f0286e38a293a793729e846b62b"
        },
        "url": "https://api.github.com/repos/itext/itext-java/git/commits/930a1c81f8ea4952df540f041befbfa2d6757838",
        "comment_count": 0,
        "verification": {
            "verified": false,
            "reason": "unsigned",
            "signature": null,
            "payload": null,
            "verified_at": null
        }
    },
    "url": "https://api.github.com/repos/itext/itext-java/commits/930a1c81f8ea4952df540f041befbfa2d6757838",
    "html_url": "https://github.com/itext/itext-java/commit/930a1c81f8ea4952df540f041befbfa2d6757838",
    "comments_url": "https://api.github.com/repos/itext/itext-java/commits/930a1c81f8ea4952df540f041befbfa2d6757838/comments",
    "author": {
        "login": "Snipx",
        "id": 695313,
        "node_id": "MDQ6VXNlcjY5NTMxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/695313?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Snipx",
        "html_url": "https://github.com/Snipx",
        "followers_url": "https://api.github.com/users/Snipx/followers",
        "following_url": "https://api.github.com/users/Snipx/following{/other_user}",
        "gists_url": "https://api.github.com/users/Snipx/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Snipx/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Snipx/subscriptions",
        "organizations_url": "https://api.github.com/users/Snipx/orgs",
        "repos_url": "https://api.github.com/users/Snipx/repos",
        "events_url": "https://api.github.com/users/Snipx/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Snipx/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "committer": {
        "login": "Snipx",
        "id": 695313,
        "node_id": "MDQ6VXNlcjY5NTMxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/695313?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Snipx",
        "html_url": "https://github.com/Snipx",
        "followers_url": "https://api.github.com/users/Snipx/followers",
        "following_url": "https://api.github.com/users/Snipx/following{/other_user}",
        "gists_url": "https://api.github.com/users/Snipx/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Snipx/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Snipx/subscriptions",
        "organizations_url": "https://api.github.com/users/Snipx/orgs",
        "repos_url": "https://api.github.com/users/Snipx/repos",
        "events_url": "https://api.github.com/users/Snipx/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Snipx/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
    },
    "parents": [
        {
            "sha": "03c809e0a3bf70308f7b37c9920c4bebaca913f2",
            "url": "https://api.github.com/repos/itext/itext-java/commits/03c809e0a3bf70308f7b37c9920c4bebaca913f2",
            "html_url": "https://github.com/itext/itext-java/commit/03c809e0a3bf70308f7b37c9920c4bebaca913f2"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 34,
        "deletions": 5
    },
    "files": [
        {
            "sha": "bdb2a5d9d3be93c96a087a28a1a496ba3ccf355c",
            "filename": "forms/src/main/java/com/itextpdf/forms/xfa/XfaForm.java",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/itext/itext-java/blob/930a1c81f8ea4952df540f041befbfa2d6757838/forms%2Fsrc%2Fmain%2Fjava%2Fcom%2Fitextpdf%2Fforms%2Fxfa%2FXfaForm.java",
            "raw_url": "https://github.com/itext/itext-java/raw/930a1c81f8ea4952df540f041befbfa2d6757838/forms%2Fsrc%2Fmain%2Fjava%2Fcom%2Fitextpdf%2Fforms%2Fxfa%2FXfaForm.java",
            "contents_url": "https://api.github.com/repos/itext/itext-java/contents/forms%2Fsrc%2Fmain%2Fjava%2Fcom%2Fitextpdf%2Fforms%2Fxfa%2FXfaForm.java?ref=930a1c81f8ea4952df540f041befbfa2d6757838",
            "patch": "@@ -57,6 +57,7 @@ This file is part of the iText (R) project.\n import org.w3c.dom.Element;\n import org.w3c.dom.Node;\n import org.w3c.dom.NodeList;\n+import org.xml.sax.EntityResolver;\n import org.xml.sax.InputSource;\n import org.xml.sax.SAXException;\n \n@@ -69,6 +70,7 @@ This file is part of the iText (R) project.\n import java.io.FileInputStream;\n import java.io.IOException;\n import java.io.InputStream;\n+import java.io.StringReader;\n import java.nio.charset.StandardCharsets;\n import java.util.HashMap;\n import java.util.Map;\n@@ -486,6 +488,7 @@ public void fillXfaForm(InputSource is, boolean readOnly) throws IOException {\n         DocumentBuilder db;\n         try {\n             db = dbf.newDocumentBuilder();\n+            db.setEntityResolver(new SafeEmptyEntityResolver());\n             Document newdoc = db.parse(is);\n             fillXfaForm(newdoc.getDocumentElement(), readOnly);\n         } catch (ParserConfigurationException e) {\n@@ -619,6 +622,7 @@ private void initXfaForm(InputStream inputStream) throws ParserConfigurationExce\n         DocumentBuilderFactory fact = DocumentBuilderFactory.newInstance();\n         fact.setNamespaceAware(true);\n         DocumentBuilder db = fact.newDocumentBuilder();\n+        db.setEntityResolver(new SafeEmptyEntityResolver());\n         setDomDocument(db.parse(inputStream));\n         xfaPresent = true;\n     }\n@@ -680,4 +684,11 @@ private Node findDataNode(Node datasetsNode) {\n         return null;\n     }\n \n+    // Prevents XXE attacks\n+    private static class SafeEmptyEntityResolver implements EntityResolver {\n+        public InputSource resolveEntity(String publicId, String systemId) throws SAXException, IOException {\n+            return new InputSource(new StringReader(\"\"));\n+        }\n+    }\n+\n }"
        },
        {
            "sha": "4ed8e4aa8b0c6f072aeb3ec543ea1c9aa0356e45",
            "filename": "kernel/src/main/java/com/itextpdf/kernel/utils/XmlUtils.java",
            "status": "modified",
            "additions": 23,
            "deletions": 5,
            "changes": 28,
            "blob_url": "https://github.com/itext/itext-java/blob/930a1c81f8ea4952df540f041befbfa2d6757838/kernel%2Fsrc%2Fmain%2Fjava%2Fcom%2Fitextpdf%2Fkernel%2Futils%2FXmlUtils.java",
            "raw_url": "https://github.com/itext/itext-java/raw/930a1c81f8ea4952df540f041befbfa2d6757838/kernel%2Fsrc%2Fmain%2Fjava%2Fcom%2Fitextpdf%2Fkernel%2Futils%2FXmlUtils.java",
            "contents_url": "https://api.github.com/repos/itext/itext-java/contents/kernel%2Fsrc%2Fmain%2Fjava%2Fcom%2Fitextpdf%2Fkernel%2Futils%2FXmlUtils.java?ref=930a1c81f8ea4952df540f041befbfa2d6757838",
            "patch": "@@ -42,9 +42,12 @@ This file is part of the iText (R) project.\n  */\n package com.itextpdf.kernel.utils;\n \n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStream;\n+import org.w3c.dom.Document;\n+import org.xml.sax.EntityResolver;\n+import org.xml.sax.InputSource;\n+import org.xml.sax.SAXException;\n+\n+import javax.xml.XMLConstants;\n import javax.xml.parsers.DocumentBuilder;\n import javax.xml.parsers.DocumentBuilderFactory;\n import javax.xml.parsers.ParserConfigurationException;\n@@ -54,12 +57,18 @@ This file is part of the iText (R) project.\n import javax.xml.transform.TransformerFactory;\n import javax.xml.transform.dom.DOMSource;\n import javax.xml.transform.stream.StreamResult;\n-import org.w3c.dom.Document;\n-import org.xml.sax.SAXException;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+import java.io.StringReader;\n \n class XmlUtils {\n     public static void writeXmlDocToStream(Document xmlReport, OutputStream stream) throws TransformerException {\n         TransformerFactory tFactory = TransformerFactory.newInstance();\n+        try {\n+            tFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n+            tFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\");\n+        } catch (Exception exc) {}\n         Transformer transformer = tFactory.newTransformer();\n         transformer.setOutputProperty(OutputKeys.INDENT, \"yes\");\n         DOMSource source = new DOMSource(xmlReport);\n@@ -74,6 +83,7 @@ public static boolean compareXmls(InputStream xml1, InputStream xml2) throws Par\n         dbf.setIgnoringElementContentWhitespace(true);\n         dbf.setIgnoringComments(true);\n         DocumentBuilder db = dbf.newDocumentBuilder();\n+        db.setEntityResolver(new SafeEmptyEntityResolver());\n \n         Document doc1 = db.parse(xml1);\n         doc1.normalizeDocument();\n@@ -87,4 +97,12 @@ public static boolean compareXmls(InputStream xml1, InputStream xml2) throws Par\n     public static Document initNewXmlDocument() throws ParserConfigurationException {\n         return DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();\n     }\n+\n+    // Prevents XXE attacks\n+    private static class SafeEmptyEntityResolver implements EntityResolver {\n+        public InputSource resolveEntity(String publicId, String systemId) throws SAXException, IOException {\n+            return new InputSource(new StringReader(\"\"));\n+        }\n+    }\n+\n }"
        }
    ]
}